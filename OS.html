<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Pufutara OS v5.5 - Ultimate Edition</title>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600&family=Poppins:wght@600;700&display=swap" rel="stylesheet">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

<style>
:root {
    --bg-os: #f9fafb;
    --window-bg: rgba(255, 255, 255, 0.98);
    --text: #111;
    --border: #e5e7eb;
    --dock-bg: rgba(255, 255, 255, 0.75);
    --shadow-window: 0 25px 80px rgba(0,0,0,0.1), 0 10px 30px rgba(0,0,0,0.04);
    --shadow-start: 0 0 0 1px rgba(0,0,0,0.03), 0 20px 40px rgba(0,0,0,0.1);
    --accent-blue: #3b82f6;
    --bing-blue: #00809d;
}

* { box-sizing: border-box; user-select: none; outline: none; }
body { margin: 0; padding: 0; font-family: 'Inter', sans-serif; overflow: hidden; height: 100vh; background: #000; color: var(--text); }

/* --- 1. WELCOME SCREEN --- */
#welcome-screen {
    position: fixed; inset: 0; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    z-index: 9999; display: flex; flex-direction: column; align-items: center; justify-content: center;
    color: #fff; transition: opacity 0.8s ease-out;
}
.welcome-logo { 
    font-family: 'Poppins'; font-size: 64px; font-weight: 700; letter-spacing: -2px; 
    margin-bottom: 20px; text-shadow: 0 10px 30px rgba(0,0,0,0.3);
    animation: float 3s infinite ease-in-out;
}
.welcome-subtitle {
    font-size: 18px; opacity: 0.9; margin-bottom: 40px;
}
.welcome-loader { 
    width: 300px; height: 4px; background: rgba(255,255,255,0.3); border-radius: 4px; overflow: hidden; 
    margin-bottom: 30px;
}
.welcome-progress { 
    width: 0%; height: 100%; background: #fff; border-radius: 4px;
    transition: width 3s cubic-bezier(0.22, 1, 0.36, 1); 
}
.welcome-tip {
    position: absolute; bottom: 40px; font-size: 14px; opacity: 0.7;
    text-align: center; max-width: 500px; padding: 0 20px;
}
@keyframes float { 
    0%, 100% { transform: translateY(0) scale(1); } 
    50% { transform: translateY(-10px) scale(1.02); } 
}

/* --- 2. BOOT SCREEN ANIMATION --- */
#boot-screen {
    position: fixed; inset: 0; background: #000; z-index: 9998;
    display: flex; flex-direction: column; align-items: center; justify-content: center;
    color: #fff; transition: opacity 0.8s ease-out;
    opacity: 0; pointer-events: none;
}
.boot-logo { 
    font-family: 'Poppins'; font-size: 48px; font-weight: 700; letter-spacing: -1px; 
    margin-bottom: 30px; 
    animation: breathe 2s infinite ease-in-out; 
}
.boot-loader { 
    width: 200px; height: 4px; background: #333; border-radius: 4px; overflow: hidden; 
}
.boot-progress { 
    width: 0%; height: 100%; background: #fff; border-radius: 4px;
    transition: width 2.5s cubic-bezier(0.22, 1, 0.36, 1); 
}
@keyframes breathe { 
    0%, 100% { opacity: 0.8; transform: scale(0.98); } 
    50% { opacity: 1; transform: scale(1.02); text-shadow: 0 0 20px rgba(255,255,255,0.3); } 
}

/* --- 3. LOCKSCREEN WINDOWS 11 STYLE (MODIF: TANPA ICON LOCK, UKURAN KECIL) --- */
#lockscreen {
    position: fixed;
    inset: 0;
    background: linear-gradient(rgba(0,0,0,0.1), rgba(0,0,0,0.5)), 
                url('wallpapersemua.png') center/cover no-repeat;
    z-index: 10000;
    display: none; /* Awalnya disembunyikan, akan muncul setelah boot */
    flex-direction: column;
    align-items: center;
    justify-content: center;
    color: white;
    transition: opacity 0.3s ease;
    text-shadow: 0 2px 10px rgba(0,0,0,0.3);
}
.lockscreen-time {
    font-size: 4rem;
    font-weight: 300;
    font-family: 'Poppins', sans-serif;
    line-height: 1.2;
    margin-bottom: 0.25rem;
}
.lockscreen-date {
    font-size: 1.2rem;
    font-weight: 300;
    opacity: 0.9;
    letter-spacing: 0.5px;
}
.lockscreen-panel {
    position: absolute;
    bottom: 20%;
    left: 50%;
    transform: translateX(-50%);
    background: rgba(255,255,255,0.2);
    backdrop-filter: blur(20px);
    -webkit-backdrop-filter: blur(20px);
    border-radius: 30px;
    padding: 15px 20px;
    width: 280px;
    display: none;
    flex-direction: column;
    align-items: center;
    gap: 10px;
    box-shadow: 0 20px 40px rgba(0,0,0,0.2);
    border: 1px solid rgba(255,255,255,0.3);
    color: white;
}
.lockscreen-panel.show {
    display: flex;
}
.panel-title {
    font-size: 1rem;
    font-weight: 400;
    margin-bottom: 5px;
}
.panel-input {
    width: 100%;
    padding: 12px 16px;
    border-radius: 40px;
    border: none;
    background: rgba(255,255,255,0.3);
    backdrop-filter: blur(10px);
    -webkit-backdrop-filter: blur(10px);
    color: white;
    font-size: 1rem;
    text-align: center;
    outline: 2px solid transparent;
    transition: outline 0.2s;
}
.panel-input::placeholder {
    color: rgba(255,255,255,0.7);
}
.panel-input:focus {
    outline: 2px solid white;
}
.panel-error {
    color: #ff9999;
    font-size: 0.8rem;
    display: none;
}
.panel-hint {
    font-size: 0.7rem;
    opacity: 0.6;
}

/* --- 4. DESKTOP ANIMATION --- */
#desktop {
    width: 100vw; height: 100vh; position: relative;
    background: url('wallpapersemua.png') center/cover no-repeat;
    background-size: cover;
    background-position: center;
    background-repeat: no-repeat;
    opacity: 0; 
    transform: scale(1.15); 
    transition: opacity 1s ease, transform 1.2s cubic-bezier(0.19, 1, 0.22, 1);
    pointer-events: none;
    display: none; /* Awalnya disembunyikan */
}
#desktop.loaded {
    opacity: 1; 
    transform: scale(1); 
    pointer-events: auto;
}

/* --- HOME CLOCK (seperti lockscreen, ukuran normal) --- */
#home-clock {
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    text-align: center;
    color: white;
    text-shadow: 0 2px 10px rgba(0,0,0,0.5);
    pointer-events: none;
    z-index: 1;
    font-family: 'Poppins', sans-serif;
}
.home-time {
    font-size: 4rem; /* sama dengan lockscreen */
    font-weight: 300;
    line-height: 1.2;
}
.home-date {
    font-size: 1.2rem; /* sama dengan lockscreen */
    font-weight: 300;
    opacity: 0.9;
}

/* --- TOP BAR ENHANCED --- */
.top-bar {
    position: absolute; top: 0; left: 0; right: 0; height: 36px;
    display: flex; justify-content: space-between; align-items: center;
    padding: 0 24px; font-size: 13px; font-weight: 500; color: var(--text);
    z-index: 10; 
    background: #fff; /* solid white, no transparency */
    border-bottom: 1px solid rgba(0,0,0,0.05);
    transition: transform 0.3s ease;
}
.top-bar.hidden {
    transform: translateY(-100%);
}
.top-center { 
    display: flex; align-items: center; gap: 15px; 
    position: absolute; left: 50%; transform: translateX(-50%);
}
.system-control {
    display: flex; align-items: center; gap: 8px;
    padding: 4px 10px; border-radius: 6px;
    background: rgba(0,0,0,0.05); /* subtle background for controls, still solid look */
    cursor: pointer; transition: all 0.2s;
}
.system-control:hover { background: rgba(0,0,0,0.1); }
.control-icon { font-size: 14px; color: #555; }
.control-value { font-size: 12px; font-weight: 600; color: #111; }
.control-dropdown {
    position: absolute; top: 36px; background: rgba(255,255,255,0.95);
    backdrop-filter: blur(20px); border-radius: 8px; padding: 10px;
    min-width: 150px; box-shadow: 0 10px 30px rgba(0,0,0,0.1);
    display: none; z-index: 1000; border: 1px solid rgba(0,0,0,0.05);
}
.control-dropdown.show { display: block; }
.slider-container { margin: 10px 0; }
.slider-container label { display: block; font-size: 11px; color: #666; margin-bottom: 5px; }
.slider { width: 100%; height: 4px; background: #e5e7eb; border-radius: 2px; outline: none; }
.control-option {
    padding: 8px 12px; border-radius: 6px; cursor: pointer;
    font-size: 12px; display: flex; align-items: center; gap: 8px;
}
.control-option:hover { background: #f3f4f6; }

/* --- WIDGETS --- */
.widgets-container {
    position: absolute; top: 60px; right: 20px;
    display: flex; flex-direction: column; gap: 15px; z-index: 5;
}
.widget {
    background: rgba(255, 255, 255, 0.85); backdrop-filter: blur(15px);
    border-radius: 12px; padding: 15px; min-width: 180px;
    box-shadow: 0 10px 25px rgba(0,0,0,0.08);
    border: 1px solid rgba(255,255,255,0.6);
    cursor: move; user-select: none;
    position: absolute;
    transition: transform 0.2s, box-shadow 0.2s;
}
.widget:hover { box-shadow: 0 15px 35px rgba(0,0,0,0.15); }
.widget.dragging { opacity: 0.8; z-index: 1001; }
.widget-header {
    display: flex; justify-content: space-between; align-items: center;
    margin-bottom: 10px; font-size: 12px; color: #666;
    font-weight: 600; cursor: default;
}
.widget-close { cursor: pointer; color: #999; font-size: 12px; }
.widget-close:hover { color: #111; }
.clock-widget { text-align: center; }
.clock-time { font-size: 32px; font-weight: 700; font-family: 'Poppins'; color: #111; }
.clock-date { font-size: 13px; color: #666; margin-top: 5px; }
.system-widget .widget-row {
    display: flex; justify-content: space-between; margin: 8px 0;
    font-size: 12px; color: #555;
}
.progress-bar {
    height: 6px; background: #e5e7eb; border-radius: 3px;
    overflow: hidden; margin-top: 2px;
}
.progress-fill {
    height: 100%; background: #3b82f6; border-radius: 3px;
}
.weather-widget .temp { font-size: 24px; font-weight: 700; color: #111; }
.weather-widget .desc { font-size: 12px; color: #666; }

/* Notes Widget */
.notes-widget textarea {
    width: 100%; height: 120px; border: 1px solid #e5e7eb;
    border-radius: 8px; padding: 10px; font-size: 12px;
    font-family: 'Inter'; resize: none; outline: none;
    background: rgba(255,255,255,0.7);
}

/* Calendar Widget */
.calendar-widget .cal-date {
    width: 24px; height: 24px; display: flex; align-items: center;
    justify-content: center; font-size: 11px; cursor: default;
}
.calendar-widget .cal-date.today {
    background: #3b82f6; color: white; border-radius: 50%;
}

/* Music Widget */
.music-widget .music-controls {
    display: flex; justify-content: center; gap: 15px;
    margin-top: 10px;
}
.music-controls button {
    background: none; border: none; font-size: 18px;
    cursor: pointer; color: #555;
}
.music-controls button:hover { color: #111; }

/* --- WIDGET TRAY --- */
.widget-tray {
    position: absolute; top: 60px; left: 20px;
    background: rgba(255, 255, 255, 0.85); backdrop-filter: blur(15px);
    border-radius: 12px; padding: 15px; width: 200px;
    box-shadow: 0 10px 25px rgba(0,0,0,0.08);
    border: 1px solid rgba(255,255,255,0.6);
    z-index: 5; display: none;
}
.widget-tray.show { display: block; }
.widget-tray-title {
    font-weight: 600; font-size: 13px; margin-bottom: 10px;
    color: #111; display: flex; justify-content: space-between;
    align-items: center;
}
.widget-tray-close { cursor: pointer; color: #999; }
.widget-tray-item {
    padding: 10px; border-radius: 8px; cursor: pointer;
    margin-bottom: 5px; font-size: 12px; display: flex;
    align-items: center; gap: 10px; transition: background 0.2s;
}
.widget-tray-item:hover { background: rgba(0,0,0,0.05); }

/* --- WINDOWS --- */
.window {
    position: absolute; background: var(--window-bg);
    border-radius: 12px;
    box-shadow: var(--shadow-window);
    display: flex; flex-direction: column;
    overflow: hidden;
    transform: scale(0.8); opacity: 0;
    transition: transform 0.4s cubic-bezier(0.19, 1, 0.22, 1), opacity 0.3s ease;
    border: 1px solid var(--border);
}
.window.open { transform: scale(1); opacity: 1; }
.window.dragging { transition: none; opacity: 0.95; box-shadow: 0 30px 60px rgba(0,0,0,0.15); }

.win-header {
    height: 44px; background: rgba(255,255,255,0.9); border-bottom: 1px solid var(--border);
    display: flex; align-items: center; justify-content: space-between; padding: 0 16px;
    cursor: grab; backdrop-filter: blur(10px);
}
.win-title { 
    font-family: 'Poppins'; font-weight: 600; font-size: 13px; color: var(--text);
    flex: 1; text-align: center;
}
.win-controls { 
    display: flex; gap: 10px; /* perbesar gap */
}
.win-btn { 
    width: 14px; height: 14px; border-radius: 50%; /* diperbesar 20% dari 12px */
    border: none; cursor: pointer; transition: .2s;
    display: flex; align-items: center; justify-content: center;
}
.btn-close { 
    background: #ff5f56; 
}
.btn-min { 
    background: #ffbd2e; 
}
.btn-max { 
    background: #27c93f; 
}
.win-btn:hover { transform: scale(1.1); }
.btn-close:hover { background: #e0443e; }
.btn-min:hover { background: #e6ac00; }
.btn-max:hover { background: #1dad34; }

.win-content { flex: 1; position: relative; overflow: hidden; display: flex; flex-direction: column; background: #fff; }
.resize-handle { position: absolute; bottom: 0; right: 0; width: 15px; height: 15px; cursor: nwse-resize; z-index: 20; }

/* --- BROWSER UI (SINGLE TAB) --- */
.browser-window {
    display: flex;
    flex-direction: column;
    height: 100%;
    background: #fff;
}
.browser-toolbar {
    display: flex;
    align-items: center;
    padding: 8px 12px;
    background: #f1f3f4;
    border-bottom: 1px solid #dadce0;
    gap: 8px;
}
.browser-nav-buttons {
    display: flex;
    gap: 4px;
}
.browser-nav-btn {
    width: 32px;
    height: 32px;
    border: none;
    background: transparent;
    border-radius: 50%;
    cursor: pointer;
    font-size: 16px;
    display: flex;
    align-items: center;
    justify-content: center;
    color: #5f6368;
}
.browser-nav-btn:hover {
    background: rgba(0,0,0,0.05);
}
.browser-nav-btn:active {
    background: rgba(0,0,0,0.1);
}
.browser-url-container {
    flex: 1;
    display: flex;
    background: white;
    border-radius: 24px;
    border: 1px solid #dadce0;
    padding: 0 8px;
    align-items: center;
    transition: box-shadow 0.2s;
}
.browser-url-container:focus-within {
    box-shadow: 0 1px 6px rgba(32,33,36,0.28);
    border-color: rgba(223,225,229,0);
}
.browser-url {
    flex: 1;
    height: 36px;
    border: none;
    padding: 0 8px;
    font-size: 14px;
    outline: none;
    background: transparent;
}
.browser-go {
    width: 36px;
    height: 36px;
    border: none;
    background: transparent;
    border-radius: 50%;
    cursor: pointer;
    font-size: 16px;
    color: #00809d;
}
.browser-go:hover {
    background: rgba(0,128,157,0.1);
}
.browser-content {
    flex: 1;
    position: relative;
    background: white;
}
.browser-frame {
    width: 100%;
    height: 100%;
    border: none;
}
.browser-home {
    width: 100%;
    height: 100%;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    background: linear-gradient(145deg, #f8f9fa, #ffffff);
}
.bing-logo {
    font-size: 72px;
    margin-bottom: 20px;
    filter: drop-shadow(0 4px 6px rgba(0,0,0,0.1));
    color: #00809d;
    font-weight: 700;
    font-family: 'Poppins', sans-serif;
}
.search-box-home {
    width: 500px;
    padding: 12px 24px;
    border-radius: 24px;
    border: 1px solid #dfe1e5;
    font-size: 16px;
    outline: none;
    box-shadow: 0 1px 2px rgba(0,0,0,0.05);
}
.search-box-home:focus {
    box-shadow: 0 1px 6px rgba(0,128,157,0.3);
    border-color: #00809d;
}
.browser-home-buttons {
    margin-top: 20px;
    display: flex;
    gap: 12px;
}
.browser-home-btn {
    padding: 10px 20px;
    background: #f8f9fa;
    border: 1px solid #f8f9fa;
    border-radius: 4px;
    color: #3c4043;
    font-size: 14px;
    cursor: pointer;
}
.browser-home-btn:hover {
    border-color: #dadce0;
    box-shadow: 0 1px 1px rgba(0,0,0,0.1);
}

/* --- SETTINGS UI --- */
.settings-window {
    display: flex;
    height: 100%;
    background: #fff;
}
.settings-sidebar {
    width: 200px;
    background: #f9fafc;
    border-right: 1px solid #e5e7eb;
    padding: 16px 0;
}
.settings-menu-item {
    padding: 10px 16px;
    font-size: 13px;
    display: flex;
    align-items: center;
    gap: 12px;
    color: #374151;
    cursor: pointer;
    border-left: 3px solid transparent;
    transition: all 0.15s;
}
.settings-menu-item i {
    width: 18px;
    text-align: center;
    color: #6b7280;
}
.settings-menu-item:hover {
    background: #f3f4f6;
}
.settings-menu-item.active {
    background: #eff6ff;
    border-left-color: #3b82f6;
    color: #2563eb;
    font-weight: 500;
}
.settings-menu-item.active i {
    color: #2563eb;
}
.settings-content {
    flex: 1;
    padding: 24px;
    overflow-y: auto;
}
.settings-section {
    display: none;
}
.settings-section.active {
    display: block;
}
.settings-section h2 {
    font-size: 20px;
    font-weight: 600;
    margin-top: 0;
    margin-bottom: 24px;
    color: #111;
}
.settings-group {
    margin-bottom: 32px;
}
.settings-group-title {
    font-size: 14px;
    font-weight: 600;
    color: #6b7280;
    margin-bottom: 16px;
    text-transform: uppercase;
    letter-spacing: 0.05em;
}
.settings-item {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 12px 0;
    border-bottom: 1px solid #f3f4f6;
}
.settings-item:last-child {
    border-bottom: none;
}
.settings-item-label {
    font-size: 14px;
    color: #374151;
}
.settings-item-label small {
    display: block;
    font-size: 12px;
    color: #6b7280;
    margin-top: 2px;
}
.settings-control {
    min-width: 140px;
    text-align: right;
}
.settings-select {
    padding: 6px 12px;
    border-radius: 6px;
    border: 1px solid #d1d5db;
    background: white;
    font-size: 13px;
    color: #111;
}
.settings-checkbox {
    width: 18px;
    height: 18px;
    accent-color: #3b82f6;
}
.settings-slider {
    width: 140px;
    height: 4px;
    background: #e5e7eb;
    border-radius: 2px;
    outline: none;
}
.settings-toggle {
    position: relative;
    display: inline-block;
    width: 44px;
    height: 24px;
    background: #e5e7eb;
    border-radius: 12px;
    cursor: pointer;
    transition: 0.2s;
}
.settings-toggle.active {
    background: #3b82f6;
}
.settings-toggle::after {
    content: "";
    position: absolute;
    top: 2px;
    left: 2px;
    width: 20px;
    height: 20px;
    background: white;
    border-radius: 50%;
    transition: 0.2s;
}
.settings-toggle.active::after {
    left: 22px;
}
.settings-info-box {
    background: #f9fafb;
    border-radius: 8px;
    padding: 16px;
    font-size: 13px;
    color: #4b5563;
    border: 1px solid #e5e7eb;
}
.settings-info-box i {
    margin-right: 8px;
    color: #3b82f6;
}

/* --- CAMERA APP --- */
.camera-container {
    width: 100%;
    height: 100%;
    display: flex;
    flex-direction: column;
    background: #111;
    position: relative;
}
.camera-video {
    width: 100%;
    height: 100%;
    object-fit: cover;
}
.camera-controls {
    position: absolute;
    bottom: 20px;
    left: 50%;
    transform: translateX(-50%);
    display: flex;
    gap: 20px;
    background: rgba(0,0,0,0.5);
    padding: 10px 20px;
    border-radius: 40px;
    backdrop-filter: blur(10px);
}
.camera-btn {
    width: 50px;
    height: 50px;
    border-radius: 50%;
    border: none;
    background: white;
    color: #111;
    font-size: 20px;
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
    transition: 0.2s;
}
.camera-btn:hover {
    transform: scale(1.1);
}
.camera-btn.capture {
    background: #ef4444;
    color: white;
}
.camera-flash {
    position: absolute;
    inset: 0;
    background: white;
    opacity: 0;
    pointer-events: none;
    transition: opacity 0.1s;
}
.camera-flash.active {
    opacity: 0.8;
}

/* --- MUSIC PLAYER ENHANCED --- */
.music-player-enhanced {
    height: 100%;
    display: flex;
    flex-direction: column;
    padding: 20px;
    background: #f9fafb;
}
.music-player-enhanced audio {
    width: 100%;
    margin: 15px 0;
}
.music-player-enhanced .file-input {
    margin: 10px 0;
    padding: 10px;
    background: #fff;
    border-radius: 8px;
    border: 1px solid #e5e7eb;
}
.music-player-enhanced .playlist {
    flex: 1;
    overflow-y: auto;
    border: 1px solid #e5e7eb;
    border-radius: 8px;
    background: #fff;
}
.music-player-enhanced .playlist-item {
    padding: 10px;
    border-bottom: 1px solid #e5e7eb;
    cursor: pointer;
    display: flex;
    align-items: center;
    gap: 10px;
}
.music-player-enhanced .playlist-item:hover {
    background: #f3f4f6;
}
.music-player-enhanced .playlist-item.playing {
    background: #e0f2fe;
    font-weight: 600;
}

/* --- VIDEO PLAYER ENHANCED --- */
.video-player-enhanced {
    height: 100%;
    display: flex;
    flex-direction: column;
    background: #000;
    color: white;
}
.video-player-enhanced video {
    width: 100%;
    flex: 1;
    background: #000;
}
.video-player-enhanced .video-controls {
    padding: 15px;
    background: #1f1f1f;
    display: flex;
    gap: 15px;
    align-items: center;
}
.video-player-enhanced .file-input {
    padding: 8px 12px;
    background: #333;
    border-radius: 6px;
    color: white;
    border: none;
    cursor: pointer;
}

/* --- GAME STYLES --- */
.game-container {
    padding: 20px;
    display: flex;
    flex-direction: column;
    align-items: center;
    height: 100%;
    background: #f9fafb;
}
.game-canvas {
    background: #111;
    border-radius: 8px;
    box-shadow: 0 4px 6px rgba(0,0,0,0.1);
}
.game-controls {
    margin-top: 20px;
    display: flex;
    gap: 16px;
}
.game-btn {
    padding: 8px 24px;
    background: #3b82f6;
    color: white;
    border: none;
    border-radius: 6px;
    font-weight: 600;
    cursor: pointer;
    font-size: 14px;
}
.game-btn:hover {
    background: #2563eb;
}
.game-score {
    margin-top: 16px;
    font-size: 18px;
    font-weight: 600;
    color: #111;
}
.ttt-grid {
    display: grid;
    grid-template-columns: repeat(3, 100px);
    gap: 10px;
    background: #e5e7eb;
    padding: 10px;
    border-radius: 8px;
}
.ttt-cell {
    width: 100px;
    height: 100px;
    background: white;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 48px;
    font-weight: 700;
    cursor: pointer;
    border-radius: 8px;
    box-shadow: 0 2px 4px rgba(0,0,0,0.05);
}
.ttt-cell:hover {
    background: #f3f4f6;
}
.memory-grid {
    display: grid;
    grid-template-columns: repeat(4, 80px);
    gap: 10px;
    padding: 20px;
    background: #e5e7eb;
    border-radius: 8px;
}
.memory-card {
    width: 80px;
    height: 80px;
    background: #3b82f6;
    border-radius: 8px;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 32px;
    color: white;
    cursor: pointer;
    transition: 0.2s;
    transform-style: preserve-3d;
}
.memory-card.flipped {
    background: white;
    color: #111;
    border: 2px solid #3b82f6;
}
.memory-card.matched {
    background: #10b981;
    color: white;
    cursor: default;
    opacity: 0.6;
}

/* --- DOCK (MAC OS STYLE) dengan Auto-Hide --- */
.dock-container { 
    position: absolute; bottom: 20px; left: 50%; transform: translateX(-50%); 
    z-index: 200; padding: 0 10px; transition: all 0.3s ease;
}
.dock-container.hidden {
    transform: translateX(-50%) translateY(100px);
    opacity: 0; pointer-events: none;
}
.dock {
    background: var(--dock-bg); backdrop-filter: blur(20px);
    border: 1px solid rgba(255,255,255,0.6);
    padding: 8px 20px; border-radius: 16px;
    display: flex; gap: 12px;
    box-shadow: 0 20px 50px rgba(0,0,0,0.1);
}
.dock-icon {
    width: 50px; height: 50px; border-radius: 10px; background: #fff;
    display: flex; align-items: center; justify-content: center; font-size: 22px;
    cursor: pointer; transition: all 0.2s cubic-bezier(0.2, 0.8, 0.2, 1);
    box-shadow: 0 2px 8px rgba(0,0,0,0.05);
    position: relative;
}
.dock-icon:hover { transform: translateY(-8px) scale(1.1); box-shadow: 0 10px 20px rgba(0,0,0,0.1); }
.dock-icon.active::after {
    content: ""; position: absolute; bottom: -4px; left: 50%;
    transform: translateX(-50%); width: 4px; height: 4px;
    background: #3b82f6; border-radius: 50%;
}

/* Right-click context menu */
.context-menu {
    position: absolute; background: rgba(255, 255, 255, 0.95);
    backdrop-filter: blur(20px); border-radius: 8px; padding: 6px 0;
    min-width: 160px; box-shadow: 0 10px 30px rgba(0,0,0,0.15);
    display: none; z-index: 1000; border: 1px solid rgba(0,0,0,0.05);
}
.context-menu.show { display: block; }
.context-item {
    padding: 8px 15px; font-size: 12px; color: #333;
    cursor: pointer; display: flex; align-items: center; gap: 8px;
    transition: background 0.2s;
}
.context-item:hover { background: #f3f4f6; }
.context-divider { height: 1px; background: #e5e7eb; margin: 4px 0; }

/* --- START MENU --- */
.start-menu {
    position: absolute; bottom: 85px; left: 50%; transform: translateX(-50%) translateY(20px);
    width: 650px; height: 580px;
    background: rgba(255, 255, 255, 0.85); backdrop-filter: blur(25px);
    border-radius: 18px; border: 1px solid rgba(255,255,255,0.5);
    box-shadow: var(--shadow-start);
    z-index: 150; padding: 24px;
    opacity: 0; pointer-events: none;
    transition: 0.3s cubic-bezier(0.2, 0.8, 0.2, 1);
    display: flex; flex-direction: column;
}
.start-menu.show { opacity: 1; transform: translateX(-50%) translateY(0); pointer-events: auto; }

.start-search {
    width: 100%; padding: 10px 15px; background: #f3f4f6; border: 1px solid transparent;
    border-radius: 8px; font-family: 'Inter'; font-size: 14px; margin-bottom: 20px;
    color: #333; transition: .2s;
}
.start-search:focus { background: #fff; border-color: #111; box-shadow: 0 0 0 2px rgba(0,0,0,0.05); }

.start-grid { 
    display: grid; grid-template-columns: repeat(6, 1fr); gap: 10px; 
    flex: 1; align-content: start; overflow-y: auto; padding-right: 5px;
}
.start-grid::-webkit-scrollbar { width: 5px; }
.start-grid::-webkit-scrollbar-thumb { background: #ccc; border-radius: 10px; }

.start-item {
    display: flex; flex-direction: column; align-items: center; gap: 8px;
    padding: 10px; border-radius: 8px; cursor: pointer; transition: .2s;
}
.start-item:hover { background: rgba(255,255,255,0.8); box-shadow: 0 2px 10px rgba(0,0,0,0.05); }
.start-icon { font-size: 24px; width: 44px; height: 44px; background: #fff; border-radius: 10px; display: flex; align-items: center; justify-content: center; box-shadow: 0 2px 5px rgba(0,0,0,0.05); }
.start-label { font-size: 11px; font-weight: 500; color: #333; text-align: center; }

.start-footer {
    margin-top: auto; padding-top: 15px; border-top: 1px solid rgba(0,0,0,0.05);
    display: flex; justify-content: space-between; align-items: center;
}
.user-profile { display: flex; align-items: center; gap: 10px; font-size: 13px; font-weight: 600; }
.power-btn { font-size: 18px; padding: 8px; border-radius: 6px; cursor: pointer; transition: .2s; }
.power-btn:hover { background: #fee2e2; color: #dc2626; }

/* --- ENHANCED FILE MANAGER STYLES --- */
.file-manager {
    display: flex;
    height: 100%;
    background: #fff;
    font-family: 'Inter', sans-serif;
}

/* Sidebar */
.file-sidebar {
    width: 200px;
    background: #f8fafc;
    border-right: 1px solid #e5e7eb;
    display: flex;
    flex-direction: column;
    padding: 15px 0;
}
.file-sidebar-section {
    padding: 0 15px;
    margin-bottom: 20px;
}
.file-sidebar-title {
    font-size: 11px;
    text-transform: uppercase;
    color: #6b7280;
    font-weight: 600;
    margin-bottom: 10px;
    letter-spacing: 0.5px;
}
.file-sidebar-item {
    padding: 8px 12px;
    border-radius: 6px;
    cursor: pointer;
    display: flex;
    align-items: center;
    gap: 10px;
    font-size: 13px;
    color: #374151;
    margin-bottom: 2px;
}
.file-sidebar-item:hover {
    background: #e2e8f0;
}
.file-sidebar-item.active {
    background: #e0f2fe;
    color: #0369a1;
    font-weight: 500;
}
.file-sidebar-item i {
    width: 18px;
    color: #64748b;
}
.file-sidebar-item.active i {
    color: #0369a1;
}

/* Main content */
.file-main {
    flex: 1;
    display: flex;
    flex-direction: column;
    overflow: hidden;
}

/* Toolbar */
.file-toolbar {
    padding: 10px 15px;
    border-bottom: 1px solid #e5e7eb;
    display: flex;
    align-items: center;
    gap: 15px;
    background: #fff;
}
.file-toolbar-btn {
    padding: 6px 12px;
    border-radius: 6px;
    border: 1px solid #e5e7eb;
    background: white;
    font-size: 12px;
    display: flex;
    align-items: center;
    gap: 6px;
    cursor: pointer;
    transition: 0.2s;
}
.file-toolbar-btn:hover {
    background: #f3f4f6;
}
.file-toolbar-btn i {
    font-size: 12px;
    color: #4b5563;
}
.file-toolbar-search {
    flex: 1;
    position: relative;
}
.file-toolbar-search input {
    width: 100%;
    padding: 8px 12px 8px 32px;
    border-radius: 20px;
    border: 1px solid #e5e7eb;
    font-size: 13px;
    outline: none;
}
.file-toolbar-search i {
    position: absolute;
    left: 10px;
    top: 50%;
    transform: translateY(-50%);
    font-size: 14px;
    color: #9ca3af;
}
.file-toolbar-search input:focus {
    border-color: #3b82f6;
    box-shadow: 0 0 0 2px rgba(59,130,246,0.1);
}

/* Path bar */
.file-path {
    padding: 8px 15px;
    background: #f9fafb;
    border-bottom: 1px solid #e5e7eb;
    display: flex;
    align-items: center;
    gap: 5px;
    font-size: 13px;
}
.file-path-item {
    color: #6b7280;
    cursor: pointer;
    padding: 4px 6px;
    border-radius: 4px;
}
.file-path-item:hover {
    background: #e5e7eb;
    color: #111;
}
.file-path-item:last-child {
    color: #111;
    font-weight: 500;
}
.file-path-separator {
    color: #9ca3af;
}

/* Files grid */
.file-grid-container {
    flex: 1;
    overflow-y: auto;
    padding: 15px;
    background: #fff;
}
.file-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(90px, 1fr));
    gap: 15px;
}
.file-grid-item {
    cursor: pointer;
    padding: 10px;
    border-radius: 8px;
    transition: 0.2s;
    position: relative;
    user-select: none;
    border: 2px solid transparent;
}
.file-grid-item:hover {
    background: #f3f4f6;
}
.file-grid-item.selected {
    background: #e0f2fe;
    border-color: #3b82f6;
}
.file-grid-item.dragging {
    opacity: 0.5;
    transform: scale(0.95);
}
.file-grid-icon {
    font-size: 40px;
    text-align: center;
    margin-bottom: 5px;
}
.file-grid-name {
    font-size: 11px;
    text-align: center;
    word-break: break-word;
    color: #374151;
    max-width: 100%;
    overflow: hidden;
    text-overflow: ellipsis;
    white-space: nowrap;
}
.file-grid-size {
    font-size: 9px;
    color: #9ca3af;
    text-align: center;
    margin-top: 2px;
}

/* Preview panel */
.file-preview {
    width: 250px;
    border-left: 1px solid #e5e7eb;
    background: #f9fafb;
    display: flex;
    flex-direction: column;
    overflow: hidden;
}
.file-preview-header {
    padding: 12px 15px;
    border-bottom: 1px solid #e5e7eb;
    font-weight: 600;
    font-size: 13px;
    color: #374151;
}
.file-preview-content {
    flex: 1;
    padding: 15px;
    overflow-y: auto;
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 15px;
}
.file-preview-icon {
    font-size: 60px;
    text-align: center;
}
.file-preview-info {
    width: 100%;
    background: white;
    border-radius: 8px;
    padding: 12px;
    border: 1px solid #e5e7eb;
}
.file-preview-info-row {
    display: flex;
    justify-content: space-between;
    font-size: 12px;
    padding: 6px 0;
    border-bottom: 1px solid #f3f4f6;
}
.file-preview-info-row:last-child {
    border-bottom: none;
}
.file-preview-label {
    color: #6b7280;
}
.file-preview-value {
    color: #111;
    font-weight: 500;
}
.file-preview-image {
    max-width: 100%;
    max-height: 200px;
    border-radius: 8px;
    border: 1px solid #e5e7eb;
}
.file-preview-video {
    max-width: 100%;
    max-height: 200px;
    border-radius: 8px;
}
.file-preview-text {
    width: 100%;
    background: white;
    border-radius: 8px;
    padding: 12px;
    border: 1px solid #e5e7eb;
    font-size: 12px;
    font-family: monospace;
    white-space: pre-wrap;
    max-height: 300px;
    overflow-y: auto;
}

/* Recycle bin */
.recycle-bin {
    background: #fff;
    height: 100%;
    display: flex;
    flex-direction: column;
}
.recycle-bin-header {
    padding: 15px;
    border-bottom: 1px solid #e5e7eb;
    font-weight: 600;
    display: flex;
    justify-content: space-between;
    align-items: center;
}
.recycle-bin-actions {
    display: flex;
    gap: 10px;
}
.recycle-bin-btn {
    padding: 6px 12px;
    border-radius: 6px;
    border: 1px solid #e5e7eb;
    background: white;
    font-size: 12px;
    cursor: pointer;
    display: flex;
    align-items: center;
    gap: 5px;
}
.recycle-bin-btn:hover {
    background: #f3f4f6;
}
.recycle-bin-btn.danger:hover {
    background: #fee2e2;
    color: #dc2626;
    border-color: #fecaca;
}
.recycle-bin-list {
    flex: 1;
    overflow-y: auto;
    padding: 15px;
}
.recycle-bin-item {
    padding: 10px;
    border-bottom: 1px solid #e5e7eb;
    display: flex;
    align-items: center;
    gap: 10px;
    cursor: pointer;
}
.recycle-bin-item:hover {
    background: #f9fafb;
}
.recycle-bin-item.selected {
    background: #e0f2fe;
}
.recycle-bin-icon {
    font-size: 24px;
}
.recycle-bin-details {
    flex: 1;
}
.recycle-bin-name {
    font-size: 13px;
    font-weight: 500;
}
.recycle-bin-meta {
    font-size: 11px;
    color: #6b7280;
}
.recycle-bin-restore {
    color: #3b82f6;
    cursor: pointer;
    padding: 5px;
}
.recycle-bin-restore:hover {
    background: #e5e7eb;
    border-radius: 4px;
}

/* --- APPS CSS (existing) --- */
.terminal {
    height: 100%; background: #111; color: #0f0; font-family: 'Courier New', monospace;
    padding: 15px; overflow-y: auto; font-size: 14px;
}
.terminal-line { margin-bottom: 5px; }
.terminal-prompt { color: #0f0; }
.terminal-input { background: transparent; border: none; color: #0f0; 
    font-family: 'Courier New', monospace; font-size: 14px; width: 80%; outline: none; }

.calc-grid { display: grid; grid-template-columns: repeat(4, 1fr); gap: 8px; padding: 15px; height: 100%; }
.calc-btn { border: none; background: #f9fafb; border-radius: 8px; font-size: 18px; font-weight: 500; cursor: pointer; transition: .1s; }
.calc-btn:hover { background: #e5e7eb; }
.calc-btn.orange { background: #111; color: #fff; }
.calc-display { grid-column: span 4; background: #fff; border: 1px solid #eee; border-radius: 8px; font-size: 28px; text-align: right; padding: 10px; margin-bottom: 10px; font-family: 'Inter'; font-weight:300;}

.app-content { padding: 20px; height: 100%; overflow-y: auto; }

/* Calendar App */
.calendar-app {
    height: 100%;
    display: flex;
    flex-direction: column;
    background: #fff;
    font-family: 'Inter', sans-serif;
}
.calendar-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 20px;
    border-bottom: 1px solid #e5e7eb;
    background: #f9fafb;
}
.calendar-header h2 {
    margin: 0;
    font-size: 20px;
    font-weight: 600;
    color: #111;
}
.calendar-nav button {
    background: none;
    border: 1px solid #e5e7eb;
    border-radius: 6px;
    padding: 6px 12px;
    margin: 0 5px;
    cursor: pointer;
    font-size: 14px;
    color: #374151;
    transition: 0.2s;
}
.calendar-nav button:hover {
    background: #f3f4f6;
}
.calendar-weekdays {
    display: grid;
    grid-template-columns: repeat(7, 1fr);
    padding: 10px 0;
    background: #f3f4f6;
    font-weight: 600;
    font-size: 12px;
    color: #6b7280;
    text-align: center;
}
.calendar-dates {
    display: grid;
    grid-template-columns: repeat(7, 1fr);
    gap: 1px;
    background: #e5e7eb;
    flex: 1;
    padding: 1px;
}
.calendar-date {
    background: white;
    padding: 10px;
    min-height: 70px;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: flex-start;
    font-size: 14px;
    color: #374151;
    position: relative;
}
.calendar-date.today {
    background: #eff6ff;
    font-weight: 600;
    color: #3b82f6;
}
.calendar-date.other-month {
    color: #9ca3af;
    background: #f9fafb;
}

/* Wallpaper app */
.wallpaper-tabs { display: flex; border-bottom: 1px solid #e5e7eb; padding: 0 20px; }
.wallpaper-tab { padding: 12px 20px; cursor: pointer; font-size: 13px; color: #6b7280; border-bottom: 2px solid transparent; }
.wallpaper-tab.active { color: #3b82f6; border-bottom-color: #3b82f6; }
.wallpaper-tab-content { display: none; padding: 20px; flex: 1; overflow-y: auto; }
.wallpaper-tab-content.active { display: block; }
.wallpaper-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 16px; }
.wallpaper-item { aspect-ratio: 16/9; border-radius: 8px; overflow: hidden; cursor: pointer; border: 2px solid transparent; transition: 0.2s; }
.wallpaper-item:hover { transform: scale(1.02); }
.wallpaper-item.active { border-color: #3b82f6; }
.wallpaper-preview { width: 100%; height: 100%; object-fit: cover; }
.wallpaper-upload-area { grid-column: span 3; border: 2px dashed #d1d5db; border-radius: 8px; padding: 40px; text-align: center; cursor: pointer; }
.wallpaper-upload-area:hover { background: #f9fafb; }
.wallpaper-upload-icon { font-size: 48px; color: #9ca3af; }
.wallpaper-upload-text { font-size: 14px; color: #6b7280; margin-top: 8px; }
</style>
</head>
<body>

<!-- WELCOME SCREEN -->
<div id="welcome-screen">
    <div class="welcome-logo">Pufutara OS</div>
    <div class="welcome-subtitle">v5.5 Ultimate Edition</div>
    <div class="welcome-loader"><div class="welcome-progress" id="welcome-bar"></div></div>
    <div class="welcome-tip">"The ultimate web-based operating system experience"</div>
</div>

<!-- BOOT SCREEN -->
<div id="boot-screen">
    <div class="boot-logo">Pufutara OS</div>
    <div class="boot-loader"><div class="boot-progress" id="boot-bar"></div></div>
</div>

<!-- LOCKSCREEN -->
<div id="lockscreen" onclick="showPasswordPanel()">
    <div class="lockscreen-time" id="lockscreen-time">--:--</div>
    <div class="lockscreen-date" id="lockscreen-date">---, -- --- ----</div>
    <!-- Panel Password -->
    <div class="lockscreen-panel" id="passwordPanel" onclick="event.stopPropagation()">
        <div class="panel-title">Masukkan kata sandi</div>
        <input type="password" class="panel-input" id="passwordInput" placeholder="Kata Sandi">
        <div class="panel-error" id="lockscreen-error">Kata sandi salah</div>
        <div class="panel-hint">coba tanya putra</div>
    </div>
</div>

<!-- DESKTOP -->
<div id="desktop" onclick="closeStartMenu(event); closeAllDropdowns(); closeWidgetTray();">
    <!-- Home Clock -->
    <div id="home-clock">
        <div class="home-time" id="home-time">--:--</div>
        <div class="home-date" id="home-date">---, -- --- ----</div>
    </div>

    <div class="top-bar" id="topBar">
        <div style="display: flex; align-items: center; gap: 20px;">
            <span style="font-weight:700; font-family:'Poppins'">Pufutara OS</span>
            <div class="system-control" onclick="event.stopPropagation(); toggleControl('sound')">
                <span class="control-icon">üîä</span>
                <span class="control-value" id="sound-value">75%</span>
                <div class="control-dropdown" id="sound-dropdown">
                    <div class="slider-container">
                        <label>Volume</label>
                        <input type="range" min="0" max="100" value="75" class="slider" id="sound-slider">
                    </div>
                    <div class="control-option" onclick="setSound(0)"><i class="fas fa-volume-mute"></i>Mute</div>
                    <div class="control-option" onclick="setSound(25)"><i class="fas fa-volume-down"></i>25%</div>
                    <div class="control-option" onclick="setSound(50)"><i class="fas fa-volume"></i>50%</div>
                    <div class="control-option" onclick="setSound(100)"><i class="fas fa-volume-up"></i>100%</div>
                </div>
            </div>
            
            <div class="system-control" onclick="event.stopPropagation(); toggleControl('brightness')">
                <span class="control-icon">‚òÄÔ∏è</span>
                <span class="control-value" id="brightness-value">80%</span>
                <div class="control-dropdown" id="brightness-dropdown">
                    <div class="slider-container">
                        <label>Kecerahan</label>
                        <input type="range" min="10" max="100" value="80" class="slider" id="brightness-slider">
                    </div>
                    <div class="control-option" onclick="setBrightness(20)"><i class="fas fa-moon"></i>Gelap</div>
                    <div class="control-option" onclick="setBrightness(50)"><i class="fas fa-adjust"></i>Medium</div>
                    <div class="control-option" onclick="setBrightness(100)"><i class="fas fa-sun"></i>Terang</div>
                </div>
            </div>
            
            <div class="system-control" onclick="event.stopPropagation(); toggleControl('wifi')">
                <span class="control-icon" id="wifi-icon">üì∂</span>
                <span class="control-value" id="wifi-value">Connected</span>
                <div class="control-dropdown" id="wifi-dropdown">
                    <div class="control-option" onclick="toggleWifi()"><i class="fas fa-wifi"></i><span id="wifi-status">Nyala</span> WiFi</div>
                    <div class="control-option" onclick="openApp('settings')"><i class="fas fa-cog"></i>Network Settings</div>
                </div>
            </div>
        </div>
        
        <div class="top-center">
            <span id="clock" style="font-feature-settings: 'tnum'; font-variant-numeric: tabular-nums; font-weight: 600;">...</span>
        </div>
        
        <div style="display: flex; align-items: center; gap: 15px;">
            <div class="system-control" onclick="event.stopPropagation(); toggleControl('battery')">
                <span class="control-icon" id="battery-icon">üîã</span>
                <span class="control-value" id="battery-value">92%</span>
                <div class="control-dropdown" id="battery-dropdown">
                    <div class="slider-container">
                        <label>Battery Saver</label>
                        <input type="range" min="0" max="100" value="92" class="slider" id="battery-slider" disabled>
                    </div>
                    <div class="control-option"><i class="fas fa-bolt"></i>Mode Hemat Daya: <span id="saver-status">Off</span></div>
                </div>
            </div>
            
            <div class="system-control" onclick="toggleWidgetTray()">
                <span class="control-icon">üìä</span>
                <span class="control-value">Widgets</span>
            </div>
        </div>
    </div>

    <!-- WIDGET TRAY -->
    <div class="widget-tray" id="widgetTray">
        <div class="widget-tray-title">
            <span>Tambah Widget</span>
            <span class="widget-tray-close" onclick="closeWidgetTray()">√ó</span>
        </div>
        <div class="widget-tray-item" onclick="addWidget('clock')">
            <i class="fas fa-clock"></i> Jam & Tanggal
        </div>
        <div class="widget-tray-item" onclick="addWidget('system')">
            <i class="fas fa-chart-bar"></i> Monitor Sistem
        </div>
        <div class="widget-tray-item" onclick="addWidget('weather')">
            <i class="fas fa-sun"></i> Cuaca
        </div>
        <div class="widget-tray-item" onclick="addWidget('notes')">
            <i class="fas fa-sticky-note"></i> Catatan Cepat
        </div>
        <div class="widget-tray-item" onclick="addWidget('calendar')">
            <i class="fas fa-calendar"></i> Kalender Mini
        </div>
        <div class="widget-tray-item" onclick="addWidget('music')">
            <i class="fas fa-music"></i> Kontrol Musik
        </div>
    </div>

    <!-- WIDGETS CONTAINER -->
    <div id="widgets-area"></div>

    <!-- CONTEXT MENU -->
    <div class="context-menu" id="contextMenu">
        <div class="context-item" id="context-open" onclick="contextOpenApp()"><i class="fas fa-play"></i>Buka</div>
        <div class="context-item" id="context-pin" onclick="contextPinApp()"><i class="fas fa-thumbtack"></i>Pin ke Dock</div>
        <div class="context-item" id="context-unpin" onclick="contextUnpinApp()"><i class="fas fa-thumbtack"></i>Lepas dari Dock</div>
        <div class="context-divider"></div>
        <div class="context-item" onclick="closeContextMenu()"><i class="fas fa-times"></i>Tutup</div>
    </div>

    <!-- WINDOWS AREA -->
    <div id="windows-area"></div>

    <!-- START MENU -->
    <div class="start-menu" id="startMenu" onclick="event.stopPropagation()">
        <input type="text" class="start-search" placeholder="Cari aplikasi...">
        <div style="font-size:12px; color:#666; margin-bottom:10px; padding-left:5px;">System & Apps</div>
        <div class="start-grid">
            <!-- System Apps -->
            <div class="start-item" onclick="openApp('files'); toggleStart()"><div class="start-icon">üìÅ</div><div class="start-label">File Explorer</div></div>
            <div class="start-item" onclick="openApp('browser'); toggleStart()"><div class="start-icon">üåç</div><div class="start-label">Browser</div></div>
            <div class="start-item" onclick="openApp('terminal'); toggleStart()"><div class="start-icon">üíª</div><div class="start-label">Terminal</div></div>
            <div class="start-item" onclick="openApp('settings'); toggleStart()"><div class="start-icon">‚öôÔ∏è</div><div class="start-label">Settings</div></div>
            <div class="start-item" onclick="openApp('calculator'); toggleStart()"><div class="start-icon">üßÆ</div><div class="start-label">Calculator</div></div>
            <div class="start-item" onclick="openApp('calendar'); toggleStart()"><div class="start-icon">üìÖ</div><div class="start-label">Calendar</div></div>
            
            <!-- Media Apps -->
            <div class="start-item" onclick="openApp('music'); toggleStart()"><div class="start-icon">üéµ</div><div class="start-label">Music Player</div></div>
            <div class="start-item" onclick="openApp('camera'); toggleStart()"><div class="start-icon">üì∑</div><div class="start-label">Camera</div></div>
            <div class="start-item" onclick="openApp('photos'); toggleStart()"><div class="start-icon">üñºÔ∏è</div><div class="start-label">Photos</div></div>
            <div class="start-item" onclick="openApp('video'); toggleStart()"><div class="start-icon">üé¨</div><div class="start-label">Video Player</div></div>
            <div class="start-item" onclick="openApp('yt'); toggleStart()"><div class="start-icon">üì∫</div><div class="start-label">YouTube</div></div>
            
            <!-- Productivity -->
            <div class="start-item" onclick="openApp('notes'); toggleStart()"><div class="start-icon">üìù</div><div class="start-label">Notes</div></div>
            <div class="start-item" onclick="openApp('texteditor'); toggleStart()"><div class="start-icon">üìÑ</div><div class="start-label">Text Editor</div></div>
            <div class="start-item" onclick="openApp('sites'); toggleStart()"><div class="start-icon" style="color:#6366f1;">üåê</div><div class="start-label">Sites Builder</div></div>
            
            <!-- Utilities -->
            <div class="start-item" onclick="openApp('wallpaper'); toggleStart()"><div class="start-icon">üé®</div><div class="start-label">Wallpaper</div></div>
            <div class="start-item" onclick="openApp('wheel'); toggleStart()"><div class="start-icon">üé°</div><div class="start-label">Spin Wheel</div></div>
            <div class="start-item" onclick="openApp('weather'); toggleStart()"><div class="start-icon">‚òÄÔ∏è</div><div class="start-label">Weather</div></div>
            <div class="start-item" onclick="openApp('maps'); toggleStart()"><div class="start-icon">üó∫Ô∏è</div><div class="start-label">Maps</div></div>
            <div class="start-item" onclick="openApp('contacts'); toggleStart()"><div class="start-icon">üìá</div><div class="start-label">Contacts</div></div>
            <div class="start-item" onclick="openApp('mail'); toggleStart()"><div class="start-icon">‚úâÔ∏è</div><div class="start-label">Mail</div></div>

            <!-- Google Apps -->
            <div class="start-item" onclick="window.open('https://mail.google.com','_blank'); toggleStart()">
                <div class="start-icon" style="color:#ea4335;">üìß</div><div class="start-label">Gmail</div>
            </div>
            <div class="start-item" onclick="window.open('https://drive.google.com','_blank'); toggleStart()">
                <div class="start-icon" style="color:#1f1f1f;">üíæ</div><div class="start-label">Drive</div>
            </div>
            <div class="start-item" onclick="window.open('https://translate.google.com','_blank'); toggleStart()">
                <div class="start-icon" style="color:#4285f4;">Êñá</div><div class="start-label">Translate</div>
            </div>
            <div class="start-item" onclick="window.open('https://photos.google.com','_blank'); toggleStart()">
                <div class="start-icon" style="color:#fbbc04;">üì∏</div><div class="start-label">Photos</div>
            </div>
            <div class="start-item" onclick="window.open('https://docs.google.com','_blank'); toggleStart()">
                <div class="start-icon" style="color:#34a853;">üìä</div><div class="start-label">Docs</div>
            </div>
            <div class="start-item" onclick="window.open('https://meet.google.com','_blank'); toggleStart()">
                <div class="start-icon" style="color:#00897b;">üé•</div><div class="start-label">Meet</div>
            </div>

            <!-- GAME GAME KECIL -->
            <div class="start-item" onclick="openApp('snake'); toggleStart()"><div class="start-icon">üêç</div><div class="start-label">Snake</div></div>
            <div class="start-item" onclick="openApp('tictactoe'); toggleStart()"><div class="start-icon">‚≠ï‚ùå</div><div class="start-label">Tic Tac Toe</div></div>
            <div class="start-item" onclick="openApp('memory'); toggleStart()"><div class="start-icon">üß†</div><div class="start-label">Memory</div></div>
        </div>
        <div class="start-footer">
            <div class="user-profile">
                <div style="width:32px; height:32px; background:#111; border-radius:50%; color:#fff; display:flex; align-items:center; justify-content:center;">P</div>
                <span>Pengguna Pufutara</span>
            </div>
            <div class="power-btn" onclick="shutdown()">‚èª</div>
        </div>
    </div>

    <!-- DOCK -->
    <div class="dock-container" id="dockContainer">
        <div class="dock" id="dock">
            <!-- Dock items akan diisi secara dinamis -->
        </div>
    </div>
</div>

<script>
// ========== VARIABLES GLOBAL ==========
let zIndex = 100;
let pinnedApps = ['files', 'browser', 'terminal', 'music', 'settings', 'calculator', 'calendar', 'weather', 'camera', 'video', 'notes', 'snake', 'tictactoe', 'memory'];
let dockItems = [];
let contextMenuTarget = null;
let soundLevel = 75;
let brightnessLevel = 80;
let wifiOn = true;
let batteryLevel = 92;
let widgets = [];
let hideTimer = null;
let mouseY = 0;
let cameraStream = null;

// File Manager variables
let currentFolder = 'home';
let selectedFiles = [];
let fileSystem = {
    home: {
        name: 'Home',
        type: 'folder',
        items: ['documents', 'downloads', 'pictures', 'music', 'videos', 'project', 'tugas.docx', 'wallpaper.jpg', 'lagu.mp3', 'video.mp4', 'setup.exe', 'data.xlsx']
    },
    documents: {
        name: 'Documents',
        type: 'folder',
        items: ['tugas.docx', 'data.xlsx', 'notes.txt', 'proposal.pdf']
    },
    downloads: {
        name: 'Downloads',
        type: 'folder',
        items: ['setup.exe', 'installer.dmg', 'archive.zip']
    },
    pictures: {
        name: 'Pictures',
        type: 'folder',
        items: ['wallpaper.jpg', 'foto1.png', 'foto2.jpg', 'screenshot.png']
    },
    music: {
        name: 'Music',
        type: 'folder',
        items: ['lagu.mp3', 'song1.mp3', 'song2.mp3', 'playlist.m3u']
    },
    videos: {
        name: 'Videos',
        type: 'folder',
        items: ['video.mp4', 'movie.mp4', 'clip.avi']
    },
    project: {
        name: 'Project',
        type: 'folder',
        items: ['index.html', 'style.css', 'script.js', 'readme.txt']
    }
};

let fileDetails = {
    'tugas.docx': { type: 'document', size: '245 KB', modified: '2025-02-20', icon: 'üìÑ' },
    'data.xlsx': { type: 'spreadsheet', size: '180 KB', modified: '2025-02-19', icon: 'üìä' },
    'notes.txt': { type: 'text', size: '2 KB', modified: '2025-02-21', icon: 'üìù' },
    'proposal.pdf': { type: 'pdf', size: '1.2 MB', modified: '2025-02-18', icon: 'üìï' },
    'wallpaper.jpg': { type: 'image', size: '850 KB', modified: '2025-02-17', icon: 'üñºÔ∏è' },
    'foto1.png': { type: 'image', size: '2.1 MB', modified: '2025-02-16', icon: 'üñºÔ∏è' },
    'foto2.jpg': { type: 'image', size: '1.5 MB', modified: '2025-02-15', icon: 'üñºÔ∏è' },
    'screenshot.png': { type: 'image', size: '320 KB', modified: '2025-02-21', icon: 'üì∏' },
    'lagu.mp3': { type: 'audio', size: '3.5 MB', modified: '2025-02-14', icon: 'üéµ' },
    'song1.mp3': { type: 'audio', size: '4.2 MB', modified: '2025-02-13', icon: 'üéµ' },
    'song2.mp3': { type: 'audio', size: '3.8 MB', modified: '2025-02-12', icon: 'üéµ' },
    'playlist.m3u': { type: 'playlist', size: '1 KB', modified: '2025-02-11', icon: 'üìã' },
    'video.mp4': { type: 'video', size: '12 MB', modified: '2025-02-10', icon: 'üé¨' },
    'movie.mp4': { type: 'video', size: '25 MB', modified: '2025-02-09', icon: 'üé¨' },
    'clip.avi': { type: 'video', size: '8 MB', modified: '2025-02-08', icon: 'üé¨' },
    'setup.exe': { type: 'application', size: '5.2 MB', modified: '2025-02-07', icon: 'üíæ' },
    'installer.dmg': { type: 'application', size: '4.5 MB', modified: '2025-02-06', icon: 'üíæ' },
    'archive.zip': { type: 'archive', size: '2.8 MB', modified: '2025-02-05', icon: 'üóúÔ∏è' },
    'index.html': { type: 'code', size: '3 KB', modified: '2025-02-21', icon: 'üåê' },
    'style.css': { type: 'code', size: '2 KB', modified: '2025-02-21', icon: 'üé®' },
    'script.js': { type: 'code', size: '5 KB', modified: '2025-02-21', icon: '‚öôÔ∏è' },
    'readme.txt': { type: 'text', size: '1 KB', modified: '2025-02-21', icon: 'üìù' }
};

let recycleBin = [];

// Music player variables
let musicPlaylist = [];
let currentMusicIndex = 0;

// ========== LOCKSCREEN LOGIC ==========
const CORRECT_PASSWORD = "coba tanya putra";
const lockscreen = document.getElementById('lockscreen');
const desktop = document.getElementById('desktop');
const passwordPanel = document.getElementById('passwordPanel');
const passwordInput = document.getElementById('passwordInput');
const errorDiv = document.getElementById('lockscreen-error');

function updateLockscreenClock() {
    const now = new Date();
    const timeStr = now.toLocaleTimeString('id-ID', { hour: '2-digit', minute: '2-digit' });
    const dateStr = now.toLocaleDateString('id-ID', { weekday: 'long', day: 'numeric', month: 'long', year: 'numeric' });
    document.getElementById('lockscreen-time').innerText = timeStr;
    document.getElementById('lockscreen-date').innerText = dateStr;
}
setInterval(updateLockscreenClock, 1000);
updateLockscreenClock();

window.showPasswordPanel = function() {
    passwordPanel.classList.add('show');
    passwordInput.focus();
};

passwordInput.addEventListener('keydown', function(e) {
    if(e.key === 'Enter') {
        if(this.value === CORRECT_PASSWORD) {
            lockscreen.style.opacity = '0';
            setTimeout(() => {
                lockscreen.style.display = 'none';
                desktop.style.display = 'block';
                setTimeout(() => {
                    desktop.classList.add('loaded');
                    initSystem();
                }, 50);
            }, 500);
        } else {
            errorDiv.style.display = 'block';
            this.value = '';
            this.focus();
        }
    }
});

// ========== WELCOME & BOOT SEQUENCE ==========
window.onload = () => {
    setTimeout(() => { 
        document.getElementById('welcome-bar').style.width = '100%'; 
    }, 100);
    
    setTimeout(() => {
        const welcomeScreen = document.getElementById('welcome-screen');
        const bootScreen = document.getElementById('boot-screen');
        
        welcomeScreen.style.opacity = '0';
        setTimeout(() => {
            welcomeScreen.style.display = 'none';
            bootScreen.style.opacity = '1';
            
            setTimeout(() => { 
                document.getElementById('boot-bar').style.width = '100%'; 
            }, 500);
            
            setTimeout(() => {
                bootScreen.style.opacity = '0';
                setTimeout(() => {
                    bootScreen.style.display = 'none';
                    lockscreen.style.display = 'flex';
                }, 1000);
            }, 3000);
        }, 800);
    }, 3500);
};

// ========== FUNGSI INISIALISASI DESKTOP ==========
function initSystem() {
    loadSavedData();
    updateClock();
    setInterval(updateClock, 1000);
    updateHomeClock();
    setInterval(updateHomeClock, 1000);
    initDock();
    document.addEventListener('click', closeContextMenu);
    document.addEventListener('contextmenu', closeContextMenu);
    setupAutoHide();
    loadWidgets();
    
    document.querySelectorAll('.start-item').forEach(item => {
        item.addEventListener('contextmenu', function(e) {
            e.preventDefault();
            e.stopPropagation();
            const appId = this.getAttribute('onclick')?.match(/openApp\('(.+?)'\)/)?.[1];
            if(appId) showContextMenu(e, appId, 'start');
        });
    });
}

function setupAutoHide() {
    const desktop = document.getElementById('desktop');
    const topBar = document.getElementById('topBar');
    const dockContainer = document.getElementById('dockContainer');
    let hideTimeout;
    
    desktop.addEventListener('mousemove', (e) => {
        mouseY = e.clientY;
        topBar.classList.remove('hidden');
        dockContainer.classList.remove('hidden');
        clearTimeout(hideTimeout);
        if (e.clientY > 50) {
            hideTimeout = setTimeout(() => {
                if (mouseY > 100) {
                    topBar.classList.add('hidden');
                    dockContainer.classList.add('hidden');
                }
            }, 3000);
        }
    });
    
    topBar.addEventListener('mouseenter', () => {
        clearTimeout(hideTimeout);
        topBar.classList.remove('hidden');
    });
    
    dockContainer.addEventListener('mouseenter', () => {
        clearTimeout(hideTimeout);
        dockContainer.classList.remove('hidden');
    });
}

// ========== LOAD/SAVE DATA ==========
function loadSavedData() {
    const savedPinned = localStorage.getItem('pufutara_pinned_apps');
    if(savedPinned) pinnedApps = JSON.parse(savedPinned);
    
    const savedWallpaper = localStorage.getItem('pufutara_wallpaper');
    if(savedWallpaper) {
        document.getElementById('desktop').style.backgroundImage = `url(${savedWallpaper})`;
    }
    
    const savedSound = localStorage.getItem('pufutara_sound');
    if(savedSound) {
        soundLevel = parseInt(savedSound);
        document.getElementById('sound-value').textContent = soundLevel + '%';
        document.getElementById('sound-slider').value = soundLevel;
    }
    
    const savedBrightness = localStorage.getItem('pufutara_brightness');
    if(savedBrightness) {
        brightnessLevel = parseInt(savedBrightness);
        document.getElementById('brightness-value').textContent = brightnessLevel + '%';
        document.getElementById('brightness-slider').value = brightnessLevel;
    }
    
    const savedRecycleBin = localStorage.getItem('pufutara_recyclebin');
    if(savedRecycleBin) {
        recycleBin = JSON.parse(savedRecycleBin);
    }
}

function savePinnedApps() {
    localStorage.setItem('pufutara_pinned_apps', JSON.stringify(pinnedApps));
}

function saveWallpaper(url) {
    localStorage.setItem('pufutara_wallpaper', url);
    document.getElementById('desktop').style.backgroundImage = `url(${url})`;
}

function saveSystemSettings() {
    localStorage.setItem('pufutara_sound', soundLevel);
    localStorage.setItem('pufutara_brightness', brightnessLevel);
}

function saveWidgets() {
    const widgetsData = widgets.map(w => ({
        type: w.type,
        x: w.x,
        y: w.y
    }));
    localStorage.setItem('pufutara_widgets', JSON.stringify(widgetsData));
}

function loadWidgets() {
    const savedWidgets = localStorage.getItem('pufutara_widgets');
    if(savedWidgets) {
        const widgetsData = JSON.parse(savedWidgets);
        widgetsData.forEach(widgetData => {
            createWidget(widgetData.type, widgetData.x, widgetData.y);
        });
    }
}

function saveRecycleBin() {
    localStorage.setItem('pufutara_recyclebin', JSON.stringify(recycleBin));
}

// ========== CLOCK ==========
function updateClock() {
    const now = new Date();
    const dateOpts = { weekday: 'short', day: 'numeric', month: 'short' };
    const timeOpts = { hour: '2-digit', minute: '2-digit' };
    const dateStr = now.toLocaleDateString('id-ID', dateOpts);
    const timeStr = now.toLocaleTimeString('id-ID', timeOpts).replace('.', ':');
    document.getElementById('clock').innerText = `${dateStr} - ${timeStr}`;
}

function updateHomeClock() {
    const now = new Date();
    const timeStr = now.toLocaleTimeString('id-ID', { hour: '2-digit', minute: '2-digit' });
    const dateStr = now.toLocaleDateString('id-ID', { weekday: 'long', day: 'numeric', month: 'long', year: 'numeric' });
    document.getElementById('home-time').innerText = timeStr;
    document.getElementById('home-date').innerText = dateStr;
}

// ========== WIDGETS ==========
function toggleWidgetTray() {
    document.getElementById('widgetTray').classList.toggle('show');
}
function closeWidgetTray() {
    document.getElementById('widgetTray').classList.remove('show');
}

function addWidget(type) {
    const x = Math.random() * (window.innerWidth - 200);
    const y = Math.random() * (window.innerHeight - 200) + 50;
    createWidget(type, x, y);
    closeWidgetTray();
}

function createWidget(type, x = 100, y = 100) {
    const widgetId = 'widget-' + Date.now() + '-' + Math.random().toString(36).substr(2, 9);
    const widget = document.createElement('div');
    widget.className = 'widget';
    widget.id = widgetId;
    widget.style.left = x + 'px';
    widget.style.top = y + 'px';
    
    let content = '';
    switch(type) {
        case 'clock':
            content = `
                <div class="widget-header"><span>Jam & Tanggal</span><span class="widget-close" onclick="removeWidget('${widgetId}')">√ó</span></div>
                <div class="clock-widget">
                    <div class="clock-time" id="${widgetId}-time">00:00</div>
                    <div class="clock-date" id="${widgetId}-date">...</div>
                </div>`;
            break;
        case 'system':
            content = `
                <div class="widget-header"><span>Sistem Monitor</span><span class="widget-close" onclick="removeWidget('${widgetId}')">√ó</span></div>
                <div class="system-widget">
                    <div class="widget-row"><span>CPU</span><span id="${widgetId}-cpu">${Math.floor(Math.random()*30+30)}%</span></div>
                    <div class="progress-bar"><div class="progress-fill" id="${widgetId}-cpu-bar"></div></div>
                    <div class="widget-row"><span>RAM</span><span id="${widgetId}-ram">${Math.floor(Math.random()*30+40)}%</span></div>
                    <div class="progress-bar"><div class="progress-fill" id="${widgetId}-ram-bar"></div></div>
                    <div class="widget-row"><span>Disk</span><span id="${widgetId}-disk">${Math.floor(Math.random()*20+20)}%</span></div>
                    <div class="progress-bar"><div class="progress-fill" id="${widgetId}-disk-bar"></div></div>
                </div>`;
            break;
        case 'weather':
            content = `
                <div class="widget-header"><span>Cuaca</span><span class="widget-close" onclick="removeWidget('${widgetId}')">√ó</span></div>
                <div class="weather-widget">
                    <div style="display:flex; align-items:center; gap:15px;">
                        <div style="font-size:40px;" id="${widgetId}-icon">‚òÄÔ∏è</div>
                        <div><div class="temp" id="${widgetId}-temp">32¬∞C</div><div class="desc" id="${widgetId}-desc">Cerah, Jakarta</div></div>
                    </div>
                </div>`;
            break;
        case 'notes':
            content = `
                <div class="widget-header"><span>Catatan Cepat</span><span class="widget-close" onclick="removeWidget('${widgetId}')">√ó</span></div>
                <div class="notes-widget"><textarea id="${widgetId}-notes" placeholder="Tulis catatan di sini..."></textarea></div>`;
            break;
        case 'calendar':
            const now = new Date();
            const days = ['M','S','S','R','K','J','S'];
            let calendarHTML = '<div class="widget-header"><span>Kalender</span><span class="widget-close" onclick="removeWidget(\''+widgetId+'\')">√ó</span></div>';
            calendarHTML += '<div class="calendar-widget" style="text-align:center;font-size:11px;">';
            calendarHTML += '<div style="display:grid;grid-template-columns:repeat(7,1fr);gap:2px;margin-bottom:5px;">';
            days.forEach(day => calendarHTML += `<div>${day}</div>`);
            calendarHTML += '</div><div style="display:grid;grid-template-columns:repeat(7,1fr);gap:2px;">';
            for(let i=1; i<=31; i++) {
                const isToday = i === now.getDate() ? 'today' : '';
                calendarHTML += `<div class="cal-date ${isToday}">${i}</div>`;
            }
            calendarHTML += '</div></div>';
            content = calendarHTML;
            break;
        case 'music':
            content = `
                <div class="widget-header"><span>Kontrol Musik</span><span class="widget-close" onclick="removeWidget('${widgetId}')">√ó</span></div>
                <div class="music-widget">
                    <div style="text-align:center;margin-bottom:10px;"><div style="font-weight:600;font-size:13px;">Now Playing</div><div style="font-size:11px;color:#666;">Lagu Favorit</div></div>
                    <div class="music-controls">
                        <button onclick="musicControl('prev')">‚èÆ</button>
                        <button onclick="musicControl('play')">‚ñ∂Ô∏è</button>
                        <button onclick="musicControl('next')">‚è≠</button>
                    </div>
                </div>`;
            break;
    }
    
    widget.innerHTML = content;
    document.getElementById('widgets-area').appendChild(widget);
    makeDraggable(widget);
    widgets.push({ id: widgetId, type: type, x: x, y: y });
    updateWidgetData(widgetId, type);
    saveWidgets();
}

function makeDraggable(element) {
    let pos1=0,pos2=0,pos3=0,pos4=0;
    element.querySelector('.widget-header').onmousedown = dragMouseDown;
    function dragMouseDown(e) {
        e = e || window.event; e.preventDefault();
        pos3 = e.clientX; pos4 = e.clientY;
        document.onmouseup = closeDragElement;
        document.onmousemove = elementDrag;
        element.classList.add('dragging');
    }
    function elementDrag(e) {
        e = e || window.event; e.preventDefault();
        pos1 = pos3 - e.clientX; pos2 = pos4 - e.clientY;
        pos3 = e.clientX; pos4 = e.clientY;
        const newTop = element.offsetTop - pos2;
        const newLeft = element.offsetLeft - pos1;
        if (newTop >= 40 && newTop <= window.innerHeight - element.offsetHeight) element.style.top = newTop + "px";
        if (newLeft >= 0 && newLeft <= window.innerWidth - element.offsetWidth) element.style.left = newLeft + "px";
        const widgetId = element.id;
        const widgetIndex = widgets.findIndex(w => w.id === widgetId);
        if (widgetIndex !== -1) { widgets[widgetIndex].x = newLeft; widgets[widgetIndex].y = newTop; }
    }
    function closeDragElement() {
        document.onmouseup = null; document.onmousemove = null;
        element.classList.remove('dragging');
        saveWidgets();
    }
}

function updateWidgetData(widgetId, type) {
    const widget = document.getElementById(widgetId);
    if (!widget) return;
    switch(type) {
        case 'clock':
            const now = new Date();
            const timeStr = now.toLocaleTimeString('id-ID', {hour:'2-digit',minute:'2-digit'}).replace('.',':');
            const dateStr = now.toLocaleDateString('id-ID', {weekday:'long',day:'numeric',month:'long',year:'numeric'});
            if(widget.querySelector('.clock-time')) {
                widget.querySelector('.clock-time').innerText = timeStr;
                widget.querySelector('.clock-date').innerText = dateStr;
            }
            break;
        case 'system':
            const cpu = Math.floor(Math.random()*30+30);
            const ram = Math.floor(Math.random()*30+40);
            const disk = Math.floor(Math.random()*20+20);
            if(widget.querySelector(`#${widgetId}-cpu`)) {
                widget.querySelector(`#${widgetId}-cpu`).innerText = cpu+'%';
                widget.querySelector(`#${widgetId}-ram`).innerText = ram+'%';
                widget.querySelector(`#${widgetId}-disk`).innerText = disk+'%';
                widget.querySelector(`#${widgetId}-cpu-bar`).style.width = cpu+'%';
                widget.querySelector(`#${widgetId}-ram-bar`).style.width = ram+'%';
                widget.querySelector(`#${widgetId}-disk-bar`).style.width = disk+'%';
            }
            break;
    }
}

function removeWidget(widgetId) {
    const widget = document.getElementById(widgetId);
    if(widget) { widget.remove(); widgets = widgets.filter(w => w.id !== widgetId); saveWidgets(); }
}

setInterval(() => {
    widgets.forEach(w => updateWidgetData(w.id, w.type));
}, 5000);

// ========== START MENU ==========
function toggleStart(e) { if(e) e.stopPropagation(); document.getElementById('startMenu').classList.toggle('show'); }
function closeStartMenu(e) { const menu = document.getElementById('startMenu'); if (menu.classList.contains('show')) menu.classList.remove('show'); }

// ========== DOCK LOGIC ==========
function initDock() {
    const dock = document.getElementById('dock');
    const startBtn = document.createElement('div');
    startBtn.className = 'dock-icon';
    startBtn.innerHTML = `<svg width="24" height="24" viewBox="0 0 24 24" fill="none"><path d="M4 4H10V10H4V4Z" fill="#111"/><path d="M14 4H20V10H14V4Z" fill="#111"/><path d="M4 14H10V20H4V14Z" fill="#111"/><path d="M14 14H20V20H14V14Z" fill="#111"/></svg>`;
    startBtn.addEventListener('click', toggleStart);
    dock.appendChild(startBtn);
    pinnedApps.forEach(appId => addToDock(appId));
}

function addToDock(appId) {
    const dock = document.getElementById('dock');
    if(dockItems.includes(appId)) return;
    const icon = document.createElement('div');
    icon.className = 'dock-icon';
    icon.dataset.appId = appId;
    icon.innerHTML = getAppEmoji(appId);
    icon.addEventListener('click', (e) => { if(e.button===0) openApp(appId); });
    icon.addEventListener('contextmenu', (e) => { e.preventDefault(); e.stopPropagation(); showContextMenu(e, appId, 'dock'); });
    dock.appendChild(icon);
    dockItems.push(appId);
}

function removeFromDock(appId) {
    const icon = document.querySelector(`.dock-icon[data-app-id="${appId}"]`);
    if(icon) { icon.remove(); dockItems = dockItems.filter(id => id !== appId); }
}

function updateDockState(appId, isOpen) {
    const icon = document.querySelector(`.dock-icon[data-app-id="${appId}"]`);
    if(icon) { if(isOpen) icon.classList.add('active'); else icon.classList.remove('active'); }
}

// ========== CONTEXT MENU ==========
function showContextMenu(e, appId, source) {
    e.preventDefault(); e.stopPropagation();
    contextMenuTarget = {appId, source};
    const menu = document.getElementById('contextMenu');
    const isPinned = pinnedApps.includes(appId);
    document.getElementById('context-pin').style.display = isPinned ? 'none' : 'flex';
    document.getElementById('context-unpin').style.display = isPinned ? 'flex' : 'none';
    document.getElementById('context-open').style.display = source === 'dock' ? 'none' : 'flex';
    menu.style.left = e.clientX + 'px';
    menu.style.top = (e.clientY - menu.offsetHeight - 10) + 'px';
    const menuRect = menu.getBoundingClientRect();
    if(menuRect.top < 0) menu.style.top = e.clientY + 10 + 'px';
    menu.classList.add('show');
}
function closeContextMenu() { document.getElementById('contextMenu').classList.remove('show'); }
function contextOpenApp() { if(contextMenuTarget) { openApp(contextMenuTarget.appId); closeContextMenu(); } }
function contextPinApp() { if(contextMenuTarget) { const {appId}=contextMenuTarget; if(!pinnedApps.includes(appId)) { pinnedApps.push(appId); savePinnedApps(); addToDock(appId); } closeContextMenu(); } }
function contextUnpinApp() { if(contextMenuTarget) { const {appId}=contextMenuTarget; pinnedApps = pinnedApps.filter(id=>id!==appId); savePinnedApps(); removeFromDock(appId); closeContextMenu(); } }

function getAppEmoji(appId) {
    const emojis = {
        'files':'üìÅ','browser':'üåç','terminal':'üíª','settings':'‚öôÔ∏è','calculator':'üßÆ','calendar':'üìÖ','music':'üéµ',
        'camera':'üì∑','photos':'üñºÔ∏è','video':'üé¨','yt':'üì∫','notes':'üìù','texteditor':'üìÑ','sites':'üåê',
        'wallpaper':'üé®','wheel':'üé°','weather':'‚òÄÔ∏è','maps':'üó∫Ô∏è','contacts':'üìá','mail':'‚úâÔ∏è',
        'snake':'üêç','tictactoe':'‚≠ï‚ùå','memory':'üß†'
    };
    return emojis[appId] || 'üì±';
}

// ========== SYSTEM CONTROLS ==========
function toggleControl(type) { closeAllDropdowns(); document.getElementById(`${type}-dropdown`).classList.toggle('show'); }
function closeAllDropdowns() { document.querySelectorAll('.control-dropdown').forEach(d => d.classList.remove('show')); }
function setSound(level) { soundLevel=level; document.getElementById('sound-value').textContent=level+'%'; document.getElementById('sound-slider').value=level; saveSystemSettings(); }
function setBrightness(level) { brightnessLevel=level; document.getElementById('brightness-value').textContent=level+'%'; document.getElementById('brightness-slider').value=level; document.getElementById('desktop').style.filter=`brightness(${level/100})`; saveSystemSettings(); }
function toggleWifi() { wifiOn=!wifiOn; document.getElementById('wifi-icon').textContent=wifiOn?'üì∂':'‚úñÔ∏è'; document.getElementById('wifi-value').textContent=wifiOn?'Connected':'Disabled'; document.getElementById('wifi-status').textContent=wifiOn?'Matikan':'Nyala'; }
function musicControl(action) { alert({ 'prev':'‚èÆ Musik sebelumnya','play':'‚ñ∂Ô∏è Memutar musik','next':'‚è≠ Musik berikutnya' }[action]); }

// ========== POWER MANAGEMENT ==========
function shutdown() {
    if(confirm('Apakah Anda yakin ingin mematikan sistem?')) {
        if(cameraStream) { cameraStream.getTracks().forEach(t=>t.stop()); cameraStream=null; }
        document.querySelectorAll('.window').forEach(win=>win.remove());
        widgets.forEach(w=>{ const el=document.getElementById(w.id); if(el) el.remove(); });
        widgets=[]; saveWidgets();
        desktop.style.display='none';
        lockscreen.style.display='flex';
        lockscreen.style.opacity='1';
        passwordInput.value='';
        passwordInput.focus();
        errorDiv.style.display='none';
        passwordPanel.classList.remove('show');
    }
}

document.getElementById('sound-slider').addEventListener('input', function(){ setSound(this.value); });
document.getElementById('brightness-slider').addEventListener('input', function(){ setBrightness(this.value); });

// ========== FILE MANAGER FUNCTIONS ==========
function openFileManager() {
    openApp('files');
}

function renderFileManager(container) {
    const folder = fileSystem[currentFolder];
    if (!folder) return;
    
    let items = folder.items || [];
    
    // Filter berdasarkan pencarian
    const searchInput = container.querySelector('.file-search-input');
    if (searchInput && searchInput.value) {
        const searchTerm = searchInput.value.toLowerCase();
        items = items.filter(item => item.toLowerCase().includes(searchTerm));
    }
    
    let html = `
    <div class="file-manager">
        <div class="file-sidebar">
            <div class="file-sidebar-section">
                <div class="file-sidebar-title">FOLDERS</div>
                <div class="file-sidebar-item ${currentFolder === 'home' ? 'active' : ''}" onclick="navigateToFolder('home')">
                    <i class="fas fa-home"></i> Home
                </div>
                <div class="file-sidebar-item ${currentFolder === 'documents' ? 'active' : ''}" onclick="navigateToFolder('documents')">
                    <i class="fas fa-file-alt"></i> Documents
                </div>
                <div class="file-sidebar-item ${currentFolder === 'downloads' ? 'active' : ''}" onclick="navigateToFolder('downloads')">
                    <i class="fas fa-download"></i> Downloads
                </div>
                <div class="file-sidebar-item ${currentFolder === 'pictures' ? 'active' : ''}" onclick="navigateToFolder('pictures')">
                    <i class="fas fa-image"></i> Pictures
                </div>
                <div class="file-sidebar-item ${currentFolder === 'music' ? 'active' : ''}" onclick="navigateToFolder('music')">
                    <i class="fas fa-music"></i> Music
                </div>
                <div class="file-sidebar-item ${currentFolder === 'videos' ? 'active' : ''}" onclick="navigateToFolder('videos')">
                    <i class="fas fa-video"></i> Videos
                </div>
                <div class="file-sidebar-item ${currentFolder === 'project' ? 'active' : ''}" onclick="navigateToFolder('project')">
                    <i class="fas fa-code"></i> Project
                </div>
            </div>
            <div class="file-sidebar-section">
                <div class="file-sidebar-title">STORAGE</div>
                <div class="file-sidebar-item" onclick="openRecycleBin()">
                    <i class="fas fa-trash"></i> Recycle Bin
                    ${recycleBin.length ? `<span style="margin-left:auto; background:#ef4444; color:white; padding:2px 6px; border-radius:10px; font-size:10px;">${recycleBin.length}</span>` : ''}
                </div>
            </div>
        </div>
        <div class="file-main">
            <div class="file-toolbar">
                <button class="file-toolbar-btn" onclick="navigateBack()"><i class="fas fa-arrow-left"></i> Back</button>
                <button class="file-toolbar-btn" onclick="createNewFolder()"><i class="fas fa-folder-plus"></i> New Folder</button>
                <button class="file-toolbar-btn" onclick="compressSelected()"><i class="fas fa-file-archive"></i> Compress</button>
                <button class="file-toolbar-btn" onclick="deleteSelected()"><i class="fas fa-trash"></i> Delete</button>
                <div class="file-toolbar-search">
                    <i class="fas fa-search"></i>
                    <input type="text" class="file-search-input" placeholder="Search files..." oninput="searchFiles(this.value)">
                </div>
            </div>
            <div class="file-path">
                <span class="file-path-item" onclick="navigateToFolder('home')">Home</span>
                ${getPathBreadcrumbs()}
            </div>
            <div class="file-grid-container">
                <div class="file-grid" id="file-grid">
                    ${renderFileGrid(items)}
                </div>
            </div>
        </div>
        <div class="file-preview" id="file-preview">
            <div class="file-preview-header">Preview</div>
            <div class="file-preview-content" id="file-preview-content">
                <div style="color:#6b7280; text-align:center; padding:20px;">Pilih file untuk preview</div>
            </div>
        </div>
    </div>
    `;
    
    container.innerHTML = html;
    
    // Setup drag and drop
    setupDragAndDrop(container);
}

function getPathBreadcrumbs() {
    if (currentFolder === 'home') return '';
    
    let path = '';
    const folder = fileSystem[currentFolder];
    if (folder) {
        path = `<span class="file-path-separator">/</span><span class="file-path-item" onclick="navigateToFolder('${currentFolder}')">${folder.name}</span>`;
    }
    return path;
}

function renderFileGrid(items) {
    if (items.length === 0) {
        return '<div style="grid-column:1/-1; text-align:center; padding:40px; color:#6b7280;">Folder kosong</div>';
    }
    
    return items.map(item => {
        const isFolder = fileSystem[item] !== undefined;
        const details = fileDetails[item] || { type: 'unknown', size: '0 KB', modified: '2025-02-21', icon: isFolder ? 'üìÅ' : 'üìÑ' };
        const icon = isFolder ? 'üìÅ' : (details.icon || 'üìÑ');
        const isSelected = selectedFiles.includes(item);
        
        return `
        <div class="file-grid-item ${isSelected ? 'selected' : ''}" 
             data-filename="${item}"
             ondblclick="openFile('${item}')"
             onclick="selectFile('${item}', event)"
             draggable="true"
             ondragstart="dragStart(event, '${item}')"
             ondragend="dragEnd(event)"
             ondrop="dropOnItem(event, '${item}')"
             ondragover="dragOver(event)">
            <div class="file-grid-icon">${icon}</div>
            <div class="file-grid-name" title="${item}">${item}</div>
            <div class="file-grid-size">${isFolder ? 'Folder' : details.size}</div>
        </div>
        `;
    }).join('');
}

function navigateToFolder(folderId) {
    if (fileSystem[folderId]) {
        currentFolder = folderId;
        selectedFiles = [];
        const win = document.querySelector('.window[id^="win-files"]');
        if (win) {
            renderFileManager(win.querySelector('.win-content'));
        }
    }
}

function navigateBack() {
    // Simple back navigation - bisa diperbaiki dengan history
    if (currentFolder !== 'home') {
        navigateToFolder('home');
    }
}

function selectFile(filename, event) {
    if (event.ctrlKey) {
        // Multi select dengan Ctrl
        const index = selectedFiles.indexOf(filename);
        if (index === -1) {
            selectedFiles.push(filename);
        } else {
            selectedFiles.splice(index, 1);
        }
    } else {
        // Single select
        selectedFiles = [filename];
    }
    
    // Update UI
    const win = document.querySelector('.window[id^="win-files"]');
    if (win) {
        const items = win.querySelectorAll('.file-grid-item');
        items.forEach(item => {
            if (selectedFiles.includes(item.dataset.filename)) {
                item.classList.add('selected');
            } else {
                item.classList.remove('selected');
            }
        });
    }
    
    // Update preview
    updatePreview(filename);
}

function updatePreview(filename) {
    const previewContent = document.getElementById('file-preview-content');
    if (!previewContent) return;
    
    const details = fileDetails[filename];
    const isFolder = fileSystem[filename] !== undefined;
    
    if (isFolder) {
        previewContent.innerHTML = `
            <div class="file-preview-icon">üìÅ</div>
            <div class="file-preview-info">
                <div class="file-preview-info-row"><span class="file-preview-label">Name:</span><span class="file-preview-value">${filename}</span></div>
                <div class="file-preview-info-row"><span class="file-preview-label">Type:</span><span class="file-preview-value">Folder</span></div>
                <div class="file-preview-info-row"><span class="file-preview-label">Items:</span><span class="file-preview-value">${fileSystem[filename].items.length}</span></div>
            </div>
        `;
    } else if (details) {
        let previewHtml = `
            <div class="file-preview-icon">${details.icon || 'üìÑ'}</div>
            <div class="file-preview-info">
                <div class="file-preview-info-row"><span class="file-preview-label">Name:</span><span class="file-preview-value">${filename}</span></div>
                <div class="file-preview-info-row"><span class="file-preview-label">Type:</span><span class="file-preview-value">${details.type}</span></div>
                <div class="file-preview-info-row"><span class="file-preview-label">Size:</span><span class="file-preview-value">${details.size}</span></div>
                <div class="file-preview-info-row"><span class="file-preview-label">Modified:</span><span class="file-preview-value">${details.modified}</span></div>
            </div>
        `;
        
        // Preview khusus untuk gambar
        if (details.type === 'image') {
            previewHtml = `
                <img src="https://via.placeholder.com/200?text=${filename}" class="file-preview-image" alt="Preview">
                ${previewHtml}
            `;
        }
        // Preview untuk video
        else if (details.type === 'video') {
            previewHtml = `
                <video class="file-preview-video" controls>
                    <source src="#" type="video/mp4">
                    Your browser does not support video.
                </video>
                ${previewHtml}
            `;
        }
        // Preview untuk teks
        else if (details.type === 'text' || details.type === 'code') {
            previewHtml = `
                <div class="file-preview-text">Ini adalah contoh isi file teks.\n\nFile: ${filename}\nUkuran: ${details.size}\n\nLorem ipsum dolor sit amet...</div>
                ${previewHtml}
            `;
        }
        
        previewContent.innerHTML = previewHtml;
    }
}

function openFile(filename) {
    const isFolder = fileSystem[filename] !== undefined;
    if (isFolder) {
        navigateToFolder(filename);
    } else {
        const details = fileDetails[filename];
        if (details) {
            if (details.type === 'image') {
                alert(`Membuka gambar: ${filename}`);
            } else if (details.type === 'audio') {
                alert(`Memutar musik: ${filename}`);
                // Bisa integrasi dengan music player
            } else if (details.type === 'video') {
                alert(`Memutar video: ${filename}`);
                // Buka video player
                openApp('video');
            } else if (details.type === 'document' || details.type === 'text' || details.type === 'code') {
                alert(`Membuka dokumen: ${filename}`);
                // Buka text editor
                openApp('texteditor');
            } else {
                alert(`Membuka file: ${filename}`);
            }
        }
    }
}

function searchFiles(query) {
    const win = document.querySelector('.window[id^="win-files"]');
    if (win) {
        renderFileManager(win.querySelector('.win-content'));
    }
}

function createNewFolder() {
    const folderName = prompt('Masukkan nama folder baru:');
    if (folderName && folderName.trim()) {
        const newFolderId = folderName.toLowerCase().replace(/\s+/g, '_');
        if (!fileSystem[newFolderId]) {
            fileSystem[newFolderId] = {
                name: folderName,
                type: 'folder',
                items: []
            };
            fileSystem[currentFolder].items.push(newFolderId);
            
            const win = document.querySelector('.window[id^="win-files"]');
            if (win) {
                renderFileManager(win.querySelector('.win-content'));
            }
        } else {
            alert('Folder dengan nama tersebut sudah ada!');
        }
    }
}

function deleteSelected() {
    if (selectedFiles.length === 0) {
        alert('Pilih file/folder yang akan dihapus');
        return;
    }
    
    if (confirm(`Yakin ingin menghapus ${selectedFiles.length} item ke Recycle Bin?`)) {
        selectedFiles.forEach(filename => {
            const index = fileSystem[currentFolder].items.indexOf(filename);
            if (index !== -1) {
                fileSystem[currentFolder].items.splice(index, 1);
                
                // Pindahkan ke recycle bin
                const details = fileDetails[filename] || { type: 'folder', size: '0 KB', modified: new Date().toISOString().split('T')[0], icon: 'üìÅ' };
                recycleBin.push({
                    name: filename,
                    originalPath: currentFolder,
                    deletedAt: new Date().toISOString(),
                    details: details
                });
            }
        });
        
        selectedFiles = [];
        saveRecycleBin();
        
        const win = document.querySelector('.window[id^="win-files"]');
        if (win) {
            renderFileManager(win.querySelector('.win-content'));
        }
    }
}

function compressSelected() {
    if (selectedFiles.length === 0) {
        alert('Pilih file/folder yang akan dikompres');
        return;
    }
    
    const zipName = prompt('Nama file archive:', 'archive.zip');
    if (zipName) {
        alert(`Membuat archive ${zipName} dengan ${selectedFiles.length} item (simulasi)`);
        // Di sini bisa implementasi zip sungguhan dengan JSZIP
    }
}

function openRecycleBin() {
    const win = document.querySelector('.window[id^="win-files"]');
    if (!win) return;
    
    let html = `
    <div class="recycle-bin">
        <div class="recycle-bin-header">
            <span>Recycle Bin</span>
            <div class="recycle-bin-actions">
                <button class="recycle-bin-btn" onclick="emptyRecycleBin()"><i class="fas fa-trash-alt"></i> Empty</button>
                <button class="recycle-bin-btn" onclick="closeRecycleBin()"><i class="fas fa-times"></i> Close</button>
            </div>
        </div>
        <div class="recycle-bin-list" id="recycle-bin-list">
            ${renderRecycleBin()}
        </div>
    </div>
    `;
    
    win.querySelector('.win-content').innerHTML = html;
}

function renderRecycleBin() {
    if (recycleBin.length === 0) {
        return '<div style="text-align:center; padding:40px; color:#6b7280;">Recycle Bin kosong</div>';
    }
    
    return recycleBin.map((item, index) => {
        const date = new Date(item.deletedAt).toLocaleString();
        return `
        <div class="recycle-bin-item" data-index="${index}">
            <div class="recycle-bin-icon">${item.details.icon || 'üìÑ'}</div>
            <div class="recycle-bin-details">
                <div class="recycle-bin-name">${item.name}</div>
                <div class="recycle-bin-meta">${item.details.size} ‚Ä¢ Dihapus: ${date}</div>
            </div>
            <div class="recycle-bin-restore" onclick="restoreFromRecycleBin(${index})" title="Restore">
                <i class="fas fa-undo-alt"></i>
            </div>
        </div>
        `;
    }).join('');
}

function restoreFromRecycleBin(index) {
    const item = recycleBin[index];
    if (item) {
        // Kembalikan ke folder asal
        if (fileSystem[item.originalPath]) {
            fileSystem[item.originalPath].items.push(item.name);
        }
        
        // Hapus dari recycle bin
        recycleBin.splice(index, 1);
        saveRecycleBin();
        
        // Refresh tampilan
        openRecycleBin();
    }
}

function emptyRecycleBin() {
    if (confirm('Yakin ingin mengosongkan Recycle Bin? Item akan dihapus permanen.')) {
        recycleBin = [];
        saveRecycleBin();
        openRecycleBin();
    }
}

function closeRecycleBin() {
    const win = document.querySelector('.window[id^="win-files"]');
    if (win) {
        renderFileManager(win.querySelector('.win-content'));
    }
}

// Drag and drop functions
function setupDragAndDrop(container) {
    const grid = container.querySelector('.file-grid');
    if (!grid) return;
    
    grid.addEventListener('dragover', (e) => {
        e.preventDefault();
    });
    
    grid.addEventListener('drop', (e) => {
        e.preventDefault();
        const draggedFile = e.dataTransfer.getData('text/plain');
        if (draggedFile && fileSystem[currentFolder]) {
            // Pindahkan file ke folder saat ini
            const sourceFolder = currentFolder; // Dalam implementasi nyata, perlu track source folder
            alert(`Memindahkan ${draggedFile} ke folder ${currentFolder} (simulasi)`);
        }
    });
}

function dragStart(e, filename) {
    e.dataTransfer.setData('text/plain', filename);
    e.target.classList.add('dragging');
}

function dragEnd(e) {
    e.target.classList.remove('dragging');
}

function dropOnItem(e, targetFilename) {
    e.preventDefault();
    e.stopPropagation();
    
    const draggedFile = e.dataTransfer.getData('text/plain');
    if (draggedFile && draggedFile !== targetFilename) {
        const isTargetFolder = fileSystem[targetFilename] !== undefined;
        
        if (isTargetFolder) {
            // Pindahkan ke folder target
            alert(`Memindahkan ${draggedFile} ke folder ${targetFilename} (simulasi)`);
        }
    }
}

function dragOver(e) {
    e.preventDefault();
}

// ========== BROWSER FUNCTIONS ==========
function browserGoBack(btn) { 
    const win = btn.closest('.window'); 
    const frame = win.querySelector('.browser-frame'); 
    try { 
        frame.contentWindow.history.back(); 
        setTimeout(() => {
            try {
                win.querySelector('.browser-url').value = frame.contentWindow.location.href;
            } catch(e) {}
        }, 100);
    } catch(e) { 
        alert('Tidak dapat kembali'); 
    } 
}

function browserGoForward(btn) { 
    const win = btn.closest('.window'); 
    const frame = win.querySelector('.browser-frame'); 
    try { 
        frame.contentWindow.history.forward(); 
        setTimeout(() => {
            try {
                win.querySelector('.browser-url').value = frame.contentWindow.location.href;
            } catch(e) {}
        }, 100);
    } catch(e) { 
        alert('Tidak dapat maju'); 
    } 
}

function browserRefresh(btn) { 
    const win = btn.closest('.window'); 
    const frame = win.querySelector('.browser-frame'); 
    frame.src = frame.src; 
}

function browserGo(btn) {
    const win = btn.closest('.window'); 
    const urlInput = win.querySelector('.browser-url'); 
    let url = urlInput.value.trim();
    if(!url) return;
    
    let fullUrl = url;
    if(!url.includes('.') || url.includes(' ')) {
        fullUrl = 'https://www.bing.com/search?q=' + encodeURIComponent(url);
    } else {
        if(!url.startsWith('http')) fullUrl = 'https://' + url;
    }
    
    const frame = win.querySelector('.browser-frame');
    frame.src = fullUrl;
    frame.style.display = 'block';
    win.querySelector('.browser-home').style.display = 'none';
    win.querySelector('.browser-url').value = fullUrl;
}

function browserHandleUrl(e, input) { 
    if(e.key === 'Enter') browserGo(input); 
}

function browserHomeSearch(e, input) {
    if(e.key === 'Enter') {
        const win = input.closest('.window'); 
        const query = input.value.trim();
        if(!query) return;
        const url = 'https://www.bing.com/search?q=' + encodeURIComponent(query);
        const frame = win.querySelector('.browser-frame');
        frame.src = url;
        frame.style.display = 'block';
        win.querySelector('.browser-home').style.display = 'none';
        win.querySelector('.browser-url').value = url;
    }
}

function browserSearch(btn) {
    const win = btn.closest('.window'); 
    const input = win.querySelector('.search-box-home'); 
    const query = input.value.trim();
    if(!query) return;
    const url = 'https://www.bing.com/search?q=' + encodeURIComponent(query);
    const frame = win.querySelector('.browser-frame');
    frame.src = url;
    frame.style.display = 'block';
    win.querySelector('.browser-home').style.display = 'none';
    win.querySelector('.browser-url').value = url;
}

function setupBrowserFrame(frame) {
    frame.addEventListener('load', function() {
        try {
            const iframeDoc = frame.contentDocument || frame.contentWindow.document;
            const links = iframeDoc.querySelectorAll('a');
            links.forEach(link => {
                link.addEventListener('click', function(e) {
                    setTimeout(() => {
                        try {
                            const win = frame.closest('.window');
                            win.querySelector('.browser-url').value = frame.contentWindow.location.href;
                        } catch(err) {}
                    }, 100);
                });
            });
            
            const observer = new MutationObserver(function(mutations) {
                mutations.forEach(function(mutation) {
                    if (mutation.addedNodes) {
                        mutation.addedNodes.forEach(function(node) {
                            if (node.nodeName === 'A') {
                                node.removeAttribute('target');
                            } else if (node.querySelectorAll) {
                                node.querySelectorAll('a[target="_blank"]').forEach(a => a.removeAttribute('target'));
                            }
                        });
                    }
                });
            });
            
            observer.observe(iframeDoc.body, { childList: true, subtree: true });
            iframeDoc.querySelectorAll('a[target="_blank"]').forEach(a => a.removeAttribute('target'));
            
        } catch(e) {
            console.log('Cross-origin iframe, tidak bisa memanipulasi link');
        }
    });
}

// ========== SETTINGS FUNCTIONS ==========
function switchSettingsSection(section, element) {
    document.querySelectorAll('.settings-menu-item').forEach(el=>el.classList.remove('active'));
    document.querySelectorAll('.settings-section').forEach(el=>el.classList.remove('active'));
    element.classList.add('active');
    document.getElementById(`settings-${section}`).classList.add('active');
}
function toggleSetting(setting, toggleElement) { toggleElement.classList.toggle('active'); console.log(`${setting} toggled: ${toggleElement.classList.contains('active')}`); }
function changeSetting(setting, value) { console.log(`${setting} changed to: ${value}`); }

// ========== CALENDAR FUNCTIONS ==========
let currentCalendarDate = new Date();
function updateCalendarDisplay() {
    const monthYearEl = document.getElementById('cal-month-year');
    const datesEl = document.getElementById('calendar-dates');
    if (!monthYearEl || !datesEl) return;
    
    const monthNames = ["Januari", "Februari", "Maret", "April", "Mei", "Juni", "Juli", "Agustus", "September", "Oktober", "November", "Desember"];
    monthYearEl.innerText = monthNames[currentCalendarDate.getMonth()] + ' ' + currentCalendarDate.getFullYear();
    
    const firstDay = new Date(currentCalendarDate.getFullYear(), currentCalendarDate.getMonth(), 1).getDay();
    const daysInMonth = new Date(currentCalendarDate.getFullYear(), currentCalendarDate.getMonth() + 1, 0).getDate();
    const today = new Date();
    
    let html = '';
    let startGap = firstDay === 0 ? 6 : firstDay - 1;
    for (let i = 0; i < startGap; i++) {
        html += `<div class="calendar-date other-month"></div>`;
    }
    for (let d = 1; d <= daysInMonth; d++) {
        const isToday = (d === today.getDate() && 
                        currentCalendarDate.getMonth() === today.getMonth() && 
                        currentCalendarDate.getFullYear() === today.getFullYear()) ? 'today' : '';
        html += `<div class="calendar-date ${isToday}">${d}</div>`;
    }
    datesEl.innerHTML = html;
}
function calendarPrevMonth() {
    currentCalendarDate.setMonth(currentCalendarDate.getMonth() - 1);
    updateCalendarDisplay();
}
function calendarNextMonth() {
    currentCalendarDate.setMonth(currentCalendarDate.getMonth() + 1);
    updateCalendarDisplay();
}

// ========== MUSIC PLAYER FUNCTIONS ==========
function handleMusicFiles(files) {
    if (!files.length) return;
    const win = document.querySelector('.window[id^="win-music"]');
    if (!win) return;
    const audio = win.querySelector('#music-audio');
    const playlistEl = win.querySelector('#music-playlist');
    
    musicPlaylist = [];
    for (let file of files) {
        musicPlaylist.push({
            name: file.name,
            url: URL.createObjectURL(file)
        });
    }
    
    playlistEl.innerHTML = '';
    musicPlaylist.forEach((item, index) => {
        const div = document.createElement('div');
        div.className = 'playlist-item' + (index === currentMusicIndex ? ' playing' : '');
        div.innerHTML = `<i class="fas fa-music"></i> ${item.name}`;
        div.onclick = () => playMusic(index);
        playlistEl.appendChild(div);
    });
    
    if (musicPlaylist.length > 0) {
        currentMusicIndex = 0;
        audio.src = musicPlaylist[0].url;
        audio.play();
    }
}
function playMusic(index) {
    const win = document.querySelector('.window[id^="win-music"]');
    if (!win) return;
    const audio = win.querySelector('#music-audio');
    const playlistItems = win.querySelectorAll('.playlist-item');
    playlistItems.forEach((item, i) => {
        if (i === index) item.classList.add('playing');
        else item.classList.remove('playing');
    });
    currentMusicIndex = index;
    audio.src = musicPlaylist[index].url;
    audio.play();
}

// ========== VIDEO PLAYER FUNCTIONS ==========
function handleVideoFile(file) {
    if (!file) return;
    const win = document.querySelector('.window[id^="win-video"]');
    if (!win) return;
    const video = win.querySelector('#video-player');
    video.src = URL.createObjectURL(file);
    video.load();
    video.play();
}

// ========== WINDOW MANAGER ==========
function openApp(id) {
    updateDockState(id,true);
    if(!dockItems.includes(id)&&!pinnedApps.includes(id)) { addToDock(id); }
    if(document.getElementById('win-'+id)) { bringToFront(document.getElementById('win-'+id)); return; }
    
    let app = apps[id];
    if (!app) {
        // Fallback untuk app yang belum didefinisikan
        app = { title: id, w: 500, h: 400, content: `<div class="app-content"><h3>${id} App</h3><p>Aplikasi sedang dalam pengembangan.</p></div>` };
    }
    
    const win=document.createElement('div'); win.className='window'; win.id='win-'+id; win.style.width=app.w+'px'; win.style.height=app.h+'px';
    const centerX=(window.innerWidth/2)-(app.w/2); const centerY=(window.innerHeight/2)-(app.h/2);
    win.style.left=centerX+'px'; win.style.top=centerY+'px'; win.style.zIndex=++zIndex;
    
    win.innerHTML=`
        <div class="win-header" onmousedown="startDrag(event, '${win.id}')">
            <div style="width:40px"></div>
            <div class="win-title">${app.title}</div>
            <div class="win-controls">
                <button class="win-btn btn-max" onclick="maximizeWindow('${win.id}')"></button>
                <button class="win-btn btn-min" onclick="minimizeWindow('${win.id}')"></button>
                <button class="win-btn btn-close" onclick="closeWindow('${win.id}')"></button>
            </div>
        </div>
        <div class="win-content">${app.content}</div>
        <div class="resize-handle" onmousedown="startResize(event, '${win.id}')"></div>
    `;
    win.addEventListener('mousedown',()=>{ bringToFront(win); updateDockState(id,true); });
    win.addEventListener('transitionend',function(e){ if(e.propertyName==='opacity'&&!this.classList.contains('open')){ updateDockState(id,false); if(!pinnedApps.includes(id)) removeFromDock(id); } });
    document.getElementById('windows-area').appendChild(win);
    setTimeout(()=>win.classList.add('open'),10);
    
    if(id==='wheel') setTimeout(initWheel,100);
    if(id==='calendar') setTimeout(() => { updateCalendarDisplay(); }, 100);
    if(id==='wallpaper') initWallpaperApp();
    if(id==='browser') {
        setTimeout(() => {
            const frame = win.querySelector('.browser-frame');
            if(frame) setupBrowserFrame(frame);
        }, 200);
    }
    if(id==='files') {
        setTimeout(() => {
            renderFileManager(win.querySelector('.win-content'));
        }, 100);
    }
}

function closeWindow(winId) {
    const win=document.getElementById(winId);
    const vid=win.querySelector('video');
    if(vid&&vid.srcObject) vid.srcObject.getTracks().forEach(t=>t.stop());
    const appId=winId.replace('win-','');
    updateDockState(appId,false);
    win.classList.remove('open');
    setTimeout(()=>{ if(win.parentNode) win.remove(); if(!pinnedApps.includes(appId)) removeFromDock(appId); },300);
}
function minimizeWindow(winId) {
    const win=document.getElementById(winId); const appId=winId.replace('win-','');
    win.style.transform='scale(0.8) translateY(100px)'; win.style.opacity='0'; win.style.pointerEvents='none';
    updateDockState(appId,false);
    setTimeout(()=>{ win.style.display='none'; },300);
}
function maximizeWindow(winId) {
    const win=document.getElementById(winId);
    if(win.classList.contains('maximized')) {
        const app=apps[winId.replace('win-','')]||{w:800,h:500};
        win.style.width=app.w+'px'; win.style.height=app.h+'px';
        win.style.top=((window.innerHeight/2)-(app.h/2))+'px'; win.style.left=((window.innerWidth/2)-(app.w/2))+'px';
        win.classList.remove('maximized');
    } else {
        win.style.width='100%'; win.style.height=(window.innerHeight-36)+'px'; win.style.top='36px'; win.style.left='0';
        win.classList.add('maximized');
    }
    bringToFront(win);
}
function bringToFront(el) { el.style.zIndex=++zIndex; const appId=el.id.replace('win-',''); updateDockState(appId,true); }

// ========== TERMINAL ==========
function handleTerminalCommand(e) {
    if(e.key==='Enter') {
        const input=e.target; const cmd=input.value.toLowerCase(); input.value='';
        const terminal=input.closest('.terminal');
        const output=document.createElement('div'); output.className='terminal-line'; output.innerHTML=`<span class="terminal-prompt">$</span> ${cmd}`;
        terminal.appendChild(output);
        let response='';
        switch(cmd) {
            case 'help': response='Commands: help, clear, date, time, echo [text], ls, pwd'; break;
            case 'clear': terminal.innerHTML='<div class="terminal-line"><span class="terminal-prompt">$</span> Terminal cleared</div><div class="terminal-line"><span class="terminal-prompt">$</span> <input type="text" class="terminal-input" onkeydown="handleTerminalCommand(event)"></div>'; return;
            case 'date': response=new Date().toLocaleDateString(); break;
            case 'time': response=new Date().toLocaleTimeString(); break;
            case 'ls': response='Documents  Downloads  Pictures  Music  Videos  Project'; break;
            case 'pwd': response='/home/user'; break;
            default: if(cmd.startsWith('echo ')) response=cmd.substring(5); else response=`Command not found: ${cmd}`;
        }
        const result=document.createElement('div'); result.className='terminal-line'; result.textContent=response;
        terminal.appendChild(result);
        const newInput=document.createElement('div'); newInput.className='terminal-line'; newInput.innerHTML='<span class="terminal-prompt">$</span> <input type="text" class="terminal-input" onkeydown="handleTerminalCommand(event)">';
        terminal.appendChild(newInput);
        terminal.scrollTop=terminal.scrollHeight;
        newInput.querySelector('input').focus();
    }
}

// ========== CALCULATOR ==========
let calcExp='';
function c(val) {
    const disp=document.getElementById('calc-res'); if(!disp)return;
    if(val==='C'){ calcExp=''; disp.value='0'; }
    else if(val==='back'){ calcExp=calcExp.slice(0,-1); disp.value=calcExp||'0'; }
    else{ calcExp+=val; disp.value=calcExp; }
}
function calc(){ try{ document.getElementById('calc-res').value=eval(calcExp); calcExp=document.getElementById('calc-res').value; } catch{ document.getElementById('calc-res').value='Error'; } }

// ========== WHEEL ==========
let wheelCtx, wheelAngle=0;
const wheelItems=['Pufu','Miaw','Jackpot','Zonk','Handy','Coba Lagi'];
const colors=['#ffffff','#f3f4f6'];
function initWheel(){ const cvs=document.getElementById('wheelCanvas'); if(!cvs) return; wheelCtx=cvs.getContext('2d'); drawWheel(); }
function drawWheel(){
    if(!wheelCtx) return;
    const w=300,h=300,cx=w/2,cy=h/2,r=140;
    wheelCtx.clearRect(0,0,w,h);
    const slice=2*Math.PI/wheelItems.length;
    wheelItems.forEach((item,i)=>{
        wheelCtx.beginPath(); wheelCtx.moveTo(cx,cy);
        wheelCtx.arc(cx,cy,r,wheelAngle+i*slice,wheelAngle+(i+1)*slice);
        wheelCtx.fillStyle=colors[i%2]; wheelCtx.fill();
        wheelCtx.save(); wheelCtx.translate(cx,cy); wheelCtx.rotate(wheelAngle+i*slice+slice/2);
        wheelCtx.textAlign="right"; wheelCtx.fillStyle="#111"; wheelCtx.font="bold 14px Inter";
        wheelCtx.fillText(item,r-10,5); wheelCtx.restore();
    });
    wheelCtx.beginPath(); wheelCtx.moveTo(w-10,cy); wheelCtx.lineTo(w-30,cy-10); wheelCtx.lineTo(w-30,cy+10);
    wheelCtx.fillStyle='#111'; wheelCtx.fill();
}
function spinWheel(){ let speed=0.5, dec=0.005; function anim(){ wheelAngle+=speed; speed-=dec; drawWheel(); if(speed>0) requestAnimationFrame(anim); } anim(); }

// ========== WALLPAPER ==========
function initWallpaperApp(){ setTimeout(()=>{ document.querySelectorAll('#wallpaper-gallery .wallpaper-item').forEach(item=>{ item.addEventListener('click',function(){ document.querySelectorAll('#wallpaper-gallery .wallpaper-item').forEach(i=>i.classList.remove('active')); this.classList.add('active'); }); }); },100); }
function switchWallpaperTab(tabName){
    document.querySelectorAll('.wallpaper-tab').forEach(tab=>tab.classList.remove('active'));
    document.querySelector(`.wallpaper-tab[onclick*="${tabName}"]`).classList.add('active');
    document.querySelectorAll('.wallpaper-tab-content').forEach(c=>c.classList.remove('active'));
    document.getElementById(`wallpaper-${tabName}`).classList.add('active');
}
function applyWallpaper(url){ saveWallpaper(url); alert('Wallpaper berhasil diubah!'); }
function applyColorWallpaper(color){ document.getElementById('desktop').style.backgroundImage='none'; document.getElementById('desktop').style.backgroundColor=color; localStorage.setItem('pufutara_wallpaper',color); }
function handleWallpaperUpload(event){
    const file=event.target.files[0]; if(!file) return;
    if(!file.type.match('image.*')){ alert('Hanya file gambar yang diperbolehkan!'); return; }
    const reader=new FileReader(); reader.onload=function(e){ applyWallpaper(e.target.result); }; reader.readAsDataURL(file);
}

// ========== DRAG WINDOW ==========
let isDragging=false, currentWin=null, offset={x:0,y:0};
function startDrag(e,id){ isDragging=true; currentWin=document.getElementById(id); const rect=currentWin.getBoundingClientRect(); offset.x=e.clientX-rect.left; offset.y=e.clientY-rect.top; currentWin.classList.add('dragging'); bringToFront(currentWin); }
document.addEventListener('mousemove',(e)=>{ if(!isDragging||!currentWin) return; e.preventDefault(); currentWin.style.left=(e.clientX-offset.x)+'px'; currentWin.style.top=(e.clientY-offset.y)+'px'; });
document.addEventListener('mouseup',()=>{ if(currentWin) currentWin.classList.remove('dragging'); isDragging=false; currentWin=null; });

// ========== RESIZE WINDOW ==========
let isResizing=false, resizeWin=null;
function startResize(e,id){ e.stopPropagation(); isResizing=true; resizeWin=document.getElementById(id); }
document.addEventListener('mousemove',(e)=>{ if(!isResizing||!resizeWin) return; resizeWin.style.width=(e.clientX-resizeWin.getBoundingClientRect().left)+'px'; resizeWin.style.height=(e.clientY-resizeWin.getBoundingClientRect().top)+'px'; });
document.addEventListener('mouseup',()=>{ isResizing=false; resizeWin=null; });

// ========== APP DATA ==========
const apps = {
    'files': {
        title: 'File Explorer', w: 900, h: 550,
        content: `<div class="file-manager-placeholder"></div>`
    },
    'browser': {
        title: 'Pufutara Browser (Bing)', w: 950, h: 600,
        content: `
            <div class="browser-window">
                <div class="browser-toolbar">
                    <div class="browser-nav-buttons">
                        <button class="browser-nav-btn" onclick="browserGoBack(this)"><i class="fas fa-arrow-left"></i></button>
                        <button class="browser-nav-btn" onclick="browserGoForward(this)"><i class="fas fa-arrow-right"></i></button>
                        <button class="browser-nav-btn" onclick="browserRefresh(this)"><i class="fas fa-redo-alt"></i></button>
                    </div>
                    <div class="browser-url-container">
                        <input type="text" class="browser-url" placeholder="Cari dengan Bing atau ketik URL" value="about:blank" onkeydown="browserHandleUrl(event, this)">
                        <button class="browser-go" onclick="browserGo(this)"><i class="fas fa-search"></i></button>
                    </div>
                </div>
                <div class="browser-content">
                    <iframe class="browser-frame" id="browser-frame" src="about:blank" sandbox="allow-same-origin allow-scripts allow-popups allow-forms" style="display: none;"></iframe>
                    <div class="browser-home" id="browser-home" style="display: flex;">
                        <div class="bing-logo">Bing</div>
                        <input type="text" class="search-box-home" placeholder="Cari dengan Bing" onkeydown="browserHomeSearch(event, this)">
                        <div class="browser-home-buttons">
                            <button class="browser-home-btn" onclick="browserSearch(this)">Cari</button>
                        </div>
                    </div>
                </div>
            </div>
        `
    },
    'terminal': {
        title: 'Terminal', w: 600, h: 400,
        content: `<div class="terminal">
            <div class="terminal-line"><span class="terminal-prompt">$</span> welcome to pufutara terminal</div>
            <div class="terminal-line"><span class="terminal-prompt">$</span> type 'help' for commands</div>
            <div class="terminal-line"><span class="terminal-prompt">$</span> <input type="text" class="terminal-input" onkeydown="handleTerminalCommand(event)"></div>
        </div>`
    },
    'settings': {
        title: 'Pengaturan Sistem', w: 700, h: 500,
        content: `
            <div class="settings-window">
                <div class="settings-sidebar">
                    <div class="settings-menu-item active" data-section="general" onclick="switchSettingsSection('general', this)">
                        <i class="fas fa-sliders-h"></i> Umum
                    </div>
                    <div class="settings-menu-item" data-section="display" onclick="switchSettingsSection('display', this)">
                        <i class="fas fa-sun"></i> Tampilan
                    </div>
                    <div class="settings-menu-item" data-section="sound" onclick="switchSettingsSection('sound', this)">
                        <i class="fas fa-volume-up"></i> Suara
                    </div>
                    <div class="settings-menu-item" data-section="network" onclick="switchSettingsSection('network', this)">
                        <i class="fas fa-wifi"></i> Jaringan
                    </div>
                    <div class="settings-menu-item" data-section="privacy" onclick="switchSettingsSection('privacy', this)">
                        <i class="fas fa-lock"></i> Privasi
                    </div>
                    <div class="settings-menu-item" data-section="about" onclick="switchSettingsSection('about', this)">
                        <i class="fas fa-info-circle"></i> Tentang
                    </div>
                </div>
                <div class="settings-content">
                    <!-- General Section -->
                    <div class="settings-section active" id="settings-general">
                        <h2>Umum</h2>
                        <div class="settings-group">
                            <div class="settings-group-title">Preferensi</div>
                            <div class="settings-item">
                                <div class="settings-item-label">
                                    Tema Gelap
                                    <small>Gunakan mode gelap di seluruh sistem</small>
                                </div>
                                <div class="settings-control">
                                    <div class="settings-toggle" onclick="toggleSetting('darkMode', this)"></div>
                                </div>
                            </div>
                            <div class="settings-item">
                                <div class="settings-item-label">
                                    Notifikasi
                                    <small>Tampilkan notifikasi dari aplikasi</small>
                                </div>
                                <div class="settings-control">
                                    <div class="settings-toggle active" onclick="toggleSetting('notifications', this)"></div>
                                </div>
                            </div>
                            <div class="settings-item">
                                <div class="settings-item-label">
                                    Bahasa
                                    <small>Pilih bahasa antarmuka</small>
                                </div>
                                <div class="settings-control">
                                    <select class="settings-select" onchange="changeSetting('language', this.value)">
                                        <option value="id">Indonesia</option>
                                        <option value="en">English</option>
                                        <option value="es">Espa√±ol</option>
                                    </select>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Display Section -->
                    <div class="settings-section" id="settings-display">
                        <h2>Tampilan</h2>
                        <div class="settings-group">
                            <div class="settings-group-title">Latar Belakang</div>
                            <div class="settings-item">
                                <div class="settings-item-label">
                                    Wallpaper
                                    <small>Ubah gambar latar belakang</small>
                                </div>
                                <div class="settings-control">
                                    <button onclick="openApp('wallpaper')" style="padding:6px 12px; border-radius:6px; border:1px solid #d1d5db; background:white; cursor:pointer;">Pilih</button>
                                </div>
                            </div>
                            <div class="settings-item">
                                <div class="settings-item-label">
                                    Kecerahan
                                    <small>Sesuaikan tingkat kecerahan layar</small>
                                </div>
                                <div class="settings-control">
                                    <input type="range" class="settings-slider" min="10" max="100" value="${brightnessLevel}" oninput="setBrightness(this.value)" onchange="setBrightness(this.value)">
                                    <span style="margin-left:8px; font-size:13px;">${brightnessLevel}%</span>
                                </div>
                            </div>
                        </div>
                        <div class="settings-group">
                            <div class="settings-group-title">Skala</div>
                            <div class="settings-item">
                                <div class="settings-item-label">
                                    Ukuran Teks
                                    <small>Perbesar atau perkecil teks</small>
                                </div>
                                <div class="settings-control">
                                    <select class="settings-select" onchange="changeSetting('fontSize', this.value)">
                                        <option value="small">Kecil</option>
                                        <option value="medium" selected>Sedang</option>
                                        <option value="large">Besar</option>
                                    </select>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Sound Section -->
                    <div class="settings-section" id="settings-sound">
                        <h2>Suara</h2>
                        <div class="settings-group">
                            <div class="settings-group-title">Volume</div>
                            <div class="settings-item">
                                <div class="settings-item-label">
                                    Volume Sistem
                                    <small>Atur tingkat volume keseluruhan</small>
                                </div>
                                <div class="settings-control">
                                    <input type="range" class="settings-slider" min="0" max="100" value="${soundLevel}" oninput="setSound(this.value)" onchange="setSound(this.value)">
                                    <span style="margin-left:8px; font-size:13px;">${soundLevel}%</span>
                                </div>
                            </div>
                            <div class="settings-item">
                                <div class="settings-item-label">
                                    Efek Suara
                                    <small>Putar suara saat interaksi</small>
                                </div>
                                <div class="settings-control">
                                    <div class="settings-toggle active" onclick="toggleSetting('soundEffects', this)"></div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Network Section -->
                    <div class="settings-section" id="settings-network">
                        <h2>Jaringan</h2>
                        <div class="settings-group">
                            <div class="settings-group-title">WiFi</div>
                            <div class="settings-item">
                                <div class="settings-item-label">
                                    WiFi
                                    <small>Nyalakan atau matikan WiFi</small>
                                </div>
                                <div class="settings-control">
                                    <div class="settings-toggle ${wifiOn ? 'active' : ''}" onclick="toggleWifi(); this.classList.toggle('active')"></div>
                                </div>
                            </div>
                            <div class="settings-item">
                                <div class="settings-item-label">
                                    Jaringan Tersedia
                                </div>
                                <div class="settings-control">
                                    <button style="padding:6px 12px; border-radius:6px; border:1px solid #d1d5db; background:white; cursor:pointer;" onclick="alert('Pencarian jaringan...')">Cari</button>
                                </div>
                            </div>
                        </div>
                        <div class="settings-info-box">
                            <i class="fas fa-info-circle"></i> Status: Terhubung ke "Pufutara_5G"
                        </div>
                    </div>
                    
                    <!-- Privacy Section -->
                    <div class="settings-section" id="settings-privacy">
                        <h2>Privasi</h2>
                        <div class="settings-group">
                            <div class="settings-group-title">Izin</div>
                            <div class="settings-item">
                                <div class="settings-item-label">
                                    Lokasi
                                    <small>Akses lokasi perangkat</small>
                                </div>
                                <div class="settings-control">
                                    <div class="settings-toggle" onclick="toggleSetting('location', this)"></div>
                                </div>
                            </div>
                            <div class="settings-item">
                                <div class="settings-item-label">
                                    Kamera
                                    <small>Akses kamera</small>
                                </div>
                                <div class="settings-control">
                                    <div class="settings-toggle" onclick="toggleSetting('camera', this)"></div>
                                </div>
                            </div>
                            <div class="settings-item">
                                <div class="settings-item-label">
                                    Mikrofon
                                    <small>Akses mikrofon</small>
                                </div>
                                <div class="settings-control">
                                    <div class="settings-toggle" onclick="toggleSetting('microphone', this)"></div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- About Section -->
                    <div class="settings-section" id="settings-about">
                        <h2>Tentang</h2>
                        <div class="settings-info-box" style="text-align:center; padding:24px;">
                            <div style="font-size:48px; margin-bottom:16px;">üñ•Ô∏è</div>
                            <h3 style="margin:0 0 8px; font-size:20px;">Pufutara OS</h3>
                            <p style="color:#6b7280; margin-bottom:16px;">Versi 5.5 Ultimate Edition</p>
                            <p style="font-size:13px;">Sistem operasi web buatan Indonesia.<br>Dibangun dengan cinta untuk pengalaman desktop modern.</p>
                            <hr style="margin:20px 0; border:0; border-top:1px solid #e5e7eb;">
                            <p style="font-size:12px; color:#9ca3af;">¬© 2025 Pufutara. Semua hak dilindungi.</p>
                        </div>
                    </div>
                </div>
            </div>
        `
    },
    'calculator': {
        title: 'Kalkulator', w: 280, h: 380,
        content: `<div style="padding:15px; height:100%; display:flex; flex-direction:column;">
            <input type="text" class="calc-display" id="calc-res" readonly value="0">
            <div class="calc-grid" style="padding:0;">
                <button class="calc-btn" onclick="c('C')">C</button><button class="calc-btn" onclick="c('/')">/</button><button class="calc-btn" onclick="c('*')">√ó</button><button class="calc-btn" onclick="c('back')">‚å´</button>
                <button class="calc-btn" onclick="c('7')">7</button><button class="calc-btn" onclick="c('8')">8</button><button class="calc-btn" onclick="c('9')">9</button><button class="calc-btn" onclick="c('-')">-</button>
                <button class="calc-btn" onclick="c('4')">4</button><button class="calc-btn" onclick="c('5')">5</button><button class="calc-btn" onclick="c('6')">6</button><button class="calc-btn" onclick="c('+')">+</button>
                <button class="calc-btn" onclick="c('1')">1</button><button class="calc-btn" onclick="c('2')">2</button><button class="calc-btn" onclick="c('3')">3</button><button class="calc-btn orange" onclick="calc()" style="grid-row:span 2;">=</button>
                <button class="calc-btn" onclick="c('0')" style="grid-column:span 2">0</button><button class="calc-btn" onclick="c('.')">.</button>
            </div>
        </div>`
    },
    'calendar': {
        title: 'Kalender', w: 450, h: 500,
        content: `<div class="calendar-app">
            <div class="calendar-header">
                <h2 id="cal-month-year">Maret 2025</h2>
                <div class="calendar-nav">
                    <button onclick="calendarPrevMonth()"><i class="fas fa-chevron-left"></i></button>
                    <button onclick="calendarNextMonth()"><i class="fas fa-chevron-right"></i></button>
                </div>
            </div>
            <div class="calendar-weekdays">
                <div>Sen</div><div>Sel</div><div>Rab</div><div>Kam</div><div>Jum</div><div>Sab</div><div>Min</div>
            </div>
            <div class="calendar-dates" id="calendar-dates"></div>
        </div>`
    },
    'music': {
        title: 'Music Player', w: 450, h: 500,
        content: `<div class="music-player-enhanced">
            <h3 style="margin-top:0; margin-bottom:15px;">Music Player</h3>
            <div class="file-input">
                <input type="file" id="music-file-input" accept="audio/*" multiple onchange="handleMusicFiles(this.files)">
                <label for="music-file-input">Pilih file audio</label>
            </div>
            <audio id="music-audio" controls style="width:100%; margin:10px 0;"></audio>
            <div class="playlist" id="music-playlist"></div>
        </div>`
    },
    'video': {
        title: 'Video Player', w: 700, h: 500,
        content: `<div class="video-player-enhanced">
            <video id="video-player" controls style="width:100%; flex:1; background:#000;"></video>
            <div class="video-controls">
                <input type="file" id="video-file-input" accept="video/*" onchange="handleVideoFile(this.files[0])">
                <span>Pilih file video</span>
            </div>
        </div>`
    },
    'camera': {
        title: 'Kamera', w: 600, h: 450,
        content: `
        <div class="camera-container">
            <video id="camera-video" class="camera-video" autoplay playsinline></video>
            <div class="camera-controls">
                <button class="camera-btn capture" onclick="capturePhoto()"><i class="fas fa-camera"></i></button>
                <button class="camera-btn" onclick="toggleCamera()"><i class="fas fa-sync-alt"></i></button>
            </div>
            <div class="camera-flash" id="camera-flash"></div>
        </div>
        <script>
            (function() {
                let video = document.getElementById('camera-video');
                let currentStream = null;
                let usingFrontCamera = true;
                
                function startCamera(facingMode = 'user') {
                    if(currentStream) currentStream.getTracks().forEach(track => track.stop());
                    navigator.mediaDevices.getUserMedia({ video: { facingMode: facingMode }, audio: false })
                    .then(function(stream) {
                        video.srcObject = stream;
                        currentStream = stream;
                        window.cameraStream = stream;
                    }).catch(function(err) { alert('Tidak dapat mengakses kamera. Pastikan izin diberikan.'); });
                }
                window.toggleCamera = function() { usingFrontCamera = !usingFrontCamera; startCamera(usingFrontCamera ? 'user' : 'environment'); };
                window.capturePhoto = function() {
                    const canvas = document.createElement('canvas');
                    canvas.width = video.videoWidth;
                    canvas.height = video.videoHeight;
                    canvas.getContext('2d').drawImage(video, 0, 0);
                    const flash = document.getElementById('camera-flash');
                    flash.classList.add('active');
                    setTimeout(() => flash.classList.remove('active'), 100);
                    const link = document.createElement('a');
                    link.download = 'pufutara-photo-' + Date.now() + '.png';
                    link.href = canvas.toDataURL('image/png');
                    link.click();
                };
                startCamera('user');
            })();
        <\/script>
        `
    },
    'photos': {
        title: 'Photos', w: 600, h: 450,
        content: `<div class="app-content">
            <h3 style="margin-top:0;">Galeri Foto</h3>
            <div style="display:grid; grid-template-columns:repeat(3,1fr); gap:10px;">
                <div style="aspect-ratio:1; background:#e5e7eb; border-radius:8px;"></div>
                <div style="aspect-ratio:1; background:#d1d5db; border-radius:8px;"></div>
                <div style="aspect-ratio:1; background:#9ca3af; border-radius:8px;"></div>
            </div>
        </div>`
    },
    'yt': {
        title: 'YouTube Player', w: 600, h: 400,
        content: `
            <iframe src="https://www.youtube.com/embed/jfKfPfyJRdk?autoplay=1" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen style="width:100%; height:100%;"></iframe>
            <div class="iframe-overlay" style="position:absolute; inset:0; display:none;"></div>`
    },
    'notes': {
        title: 'Catatan', w: 350, h: 400,
        content: `<textarea style="width:100%; height:100%; border:none; padding:20px; resize:none; outline:none; font-family:Inter; font-size:15px; line-height:1.6;" placeholder="Ketik ide brilianmu..."></textarea>`
    },
    'texteditor': {
        title: 'Text Editor', w: 500, h: 400,
        content: `<textarea style="width:100%; height:100%; border:none; padding:20px; resize:none; outline:none; font-family:'Courier New', monospace; font-size:14px;" placeholder="Mulai menulis..."></textarea>`
    },
    'sites': {
        title: 'Sites Builder', w: 850, h: 550,
        content: `<div style="display:flex; flex-direction:column; height:100%;">
            <div style="height:50px; border-bottom:1px solid #ddd; display:flex; align-items:center; padding:0 20px; justify-content:space-between;">
                <div style="display:flex; align-items:center; gap:10px;"><div style="width:24px; height:24px; background:#6366f1; border-radius:4px;"></div><span style="font-weight:600; color:#444;">Situs Tanpa Judul</span></div>
                <button onclick="alert('Berhasil dipublikasikan (Bohongan)!')" style="background:#6366f1; color:white; border:none; padding:8px 20px; border-radius:4px; cursor:pointer;">Publikasikan</button>
            </div>
            <div style="flex:1; display:flex; background:#f0f0f0;">
                <div style="flex:1; margin:20px; background:white; box-shadow:0 2px 10px rgba(0,0,0,0.1); display:flex; flex-direction:column;">
                    <div style="height:200px; background:#e0e7ff; display:flex; align-items:end; padding:20px; border-bottom:1px solid #eee;"><h1 style="margin:0; font-size:32px; color:#333;">Judul Halaman Anda</h1></div>
                    <div style="padding:40px; color:#666;">Klik di sini untuk mengedit konten...</div>
                </div>
                <div style="width:200px; background:white; border-left:1px solid #ddd; padding:15px;">
                    <h4 style="margin-top:0;">Sisipkan</h4>
                    <div style="display:grid; grid-template-columns:1fr 1fr; gap:10px;">
                        <button style="padding:10px; border:1px solid #ddd; background:white;">Kotak Teks</button>
                        <button style="padding:10px; border:1px solid #ddd; background:white;">Gambar</button>
                        <button style="padding:10px; border:1px solid #ddd; background:white;">Drive</button>
                        <button style="padding:10px; border:1px solid #ddd; background:white;">Sematkan</button>
                    </div>
                </div>
            </div>
        </div>`
    },
    'wallpaper': {
        title: 'Wallpaper Settings', w: 500, h: 450,
        content: `
        <div style="height:100%; display:flex; flex-direction:column;">
            <div class="wallpaper-tabs">
                <div class="wallpaper-tab active" onclick="switchWallpaperTab('gallery')">Galeri</div>
                <div class="wallpaper-tab" onclick="switchWallpaperTab('upload')">Upload</div>
                <div class="wallpaper-tab" onclick="switchWallpaperTab('colors')">Warna</div>
            </div>
            <div class="wallpaper-tab-content active" id="wallpaper-gallery">
                <div class="wallpaper-grid">
                    <div class="wallpaper-item" onclick="applyWallpaper('https://images.unsplash.com/photo-1506905925346-21bda4d32df4?w=800&auto=format&fit=crop')"><img src="https://images.unsplash.com/photo-1506905925346-21bda4d32df4?w=400&auto=format&fit=crop" class="wallpaper-preview"></div>
                    <div class="wallpaper-item" onclick="applyWallpaper('https://images.unsplash.com/photo-1519681393784-d120267933ba?w=800&auto=format&fit=crop')"><img src="https://images.unsplash.com/photo-1519681393784-d120267933ba?w=400&auto=format&fit=crop" class="wallpaper-preview"></div>
                    <div class="wallpaper-item" onclick="applyWallpaper('https://images.unsplash.com/photo-1518837695005-2083093ee35b?w=800&auto=format&fit=crop')"><img src="https://images.unsplash.com/photo-1518837695005-2083093ee35b?w=400&auto=format&fit=crop" class="wallpaper-preview"></div>
                    <div class="wallpaper-item" onclick="applyWallpaper('https://images.unsplash.com/photo-1501854140801-50d01698950b?w=800&auto=format&fit=crop')"><img src="https://images.unsplash.com/photo-1501854140801-50d01698950b?w=400&auto=format&fit=crop" class="wallpaper-preview"></div>
                    <div class="wallpaper-item" onclick="applyWallpaper('https://images.unsplash.com/photo-1470071459604-3b5ec3a7fe05?w=800&auto=format&fit=crop')"><img src="https://images.unsplash.com/photo-1470071459604-3b5ec3a7fe05?w=400&auto=format&fit=crop" class="wallpaper-preview"></div>
                    <div class="wallpaper-item" onclick="applyWallpaper('https://images.unsplash.com/photo-1439066615861-d1af74d74000?w=800&auto=format&fit=crop')"><img src="https://images.unsplash.com/photo-1439066615861-d1af74d74000?w=400&auto=format&fit=crop" class="wallpaper-preview"></div>
                </div>
            </div>
            <div class="wallpaper-tab-content" id="wallpaper-upload">
                <div class="wallpaper-grid"><div class="wallpaper-upload-area" onclick="document.getElementById('file-upload').click()"><div class="wallpaper-upload-icon">üì§</div><div class="wallpaper-upload-text">Klik untuk upload gambar</div><div class="wallpaper-upload-text" style="font-size:12px; margin-top:5px;">Format: JPG, PNG, GIF</div></div></div>
                <input type="file" id="file-upload" accept="image/*" style="display:none" onchange="handleWallpaperUpload(event)">
            </div>
            <div class="wallpaper-tab-content" id="wallpaper-colors">
                <div class="wallpaper-grid">
                    <div class="wallpaper-item" style="background:#f9fafb" onclick="applyColorWallpaper('#f9fafb')">Light Gray</div>
                    <div class="wallpaper-item" style="background:#e5e7eb" onclick="applyColorWallpaper('#e5e7eb')">Gray</div>
                    <div class="wallpaper-item" style="background:#dbeafe" onclick="applyColorWallpaper('#dbeafe')">Blue Light</div>
                    <div class="wallpaper-item" style="background:#fef3c7" onclick="applyColorWallpaper('#fef3c7')">Yellow Light</div>
                    <div class="wallpaper-item" style="background:#fce7f3" onclick="applyColorWallpaper('#fce7f3')">Pink Light</div>
                    <div class="wallpaper-item" style="background:#dcfce7" onclick="applyColorWallpaper('#dcfce7')">Green Light</div>
                </div>
            </div>
        </div>`
    },
    'wheel': {
        title: 'Spin Wheel', w: 350, h: 420,
        content: `<div style="display:flex; flex-direction:column; height:100%; align-items:center; justify-content:center; padding:10px;"><canvas id="wheelCanvas" width="300" height="300"></canvas><button onclick="spinWheel()" style="margin-top:15px; background:#111; color:#fff; border:none; padding:10px 40px; border-radius:99px; font-weight:600; cursor:pointer;">PUTAR</button></div>`
    },
    'weather': {
        title: 'Weather', w: 350, h: 300,
        content: `<div class="app-content" style="text-align:center;"><div style="font-size:60px;">‚òÄÔ∏è</div><div style="font-size:40px; font-weight:700;">32¬∞C</div><div style="color:#666;">Cerah, Jakarta</div><div style="margin-top:20px; font-size:14px; color:#555;">Kelembaban: 65%</div><div style="font-size:14px; color:#555;">Angin: 10 km/h</div></div>`
    },
    'maps': {
        title: 'Maps', w: 600, h: 500,
        content: `<div class="app-content"><h3 style="margin-top:0;">Peta</h3><div style="background:#e5e7eb; height:300px; border-radius:8px; display:flex; align-items:center; justify-content:center; color:#666;">üó∫Ô∏è Peta akan tampil di sini</div></div>`
    },
    'contacts': {
        title: 'Contacts', w: 400, h: 450,
        content: `<div class="app-content"><h3 style="margin-top:0;">Kontak</h3><div style="display:flex; flex-direction:column; gap:10px;"><div style="display:flex; align-items:center; gap:10px; padding:10px; background:#f9fafb; border-radius:8px;"><div style="width:40px; height:40px; background:#3b82f6; border-radius:50%; color:white; display:flex; align-items:center; justify-content:center;">A</div><div><div style="font-weight:600;">Andi</div><div style="font-size:12px; color:#666;">08123456789</div></div></div><div style="display:flex; align-items:center; gap:10px; padding:10px; background:#f9fafb; border-radius:8px;"><div style="width:40px; height:40px; background:#10b981; border-radius:50%; color:white; display:flex; align-items:center; justify-content:center;">B</div><div><div style="font-weight:600;">Budi</div><div style="font-size:12px; color:#666;">08987654321</div></div></div></div></div>`
    },
    'mail': {
        title: 'Mail', w: 600, h: 500,
        content: `<div class="app-content"><h3 style="margin-top:0;">Email</h3><div style="display:flex; flex-direction:column; gap:10px;"><div style="padding:15px; background:#f9fafb; border-radius:8px; cursor:pointer;"><div style="font-weight:600;">Selamat Datang di Pufutara OS</div><div style="font-size:12px; color:#666;">From: System Admin</div></div><div style="padding:15px; background:#f9fafb; border-radius:8px; cursor:pointer;"><div style="font-weight:600;">Update Sistem Tersedia</div><div style="font-size:12px; color:#666;">From: Update Center</div></div></div></div>`
    },
    'snake': {
        title: 'Snake', w: 500, h: 500,
        content: `<div class="game-container"><h3>Snake Game</h3><p>Coming soon...</p></div>`
    },
    'tictactoe': {
        title: 'Tic Tac Toe', w: 400, h: 450,
        content: `<div class="game-container"><h3>Tic Tac Toe</h3><p>Coming soon...</p></div>`
    },
    'memory': {
        title: 'Memory Game', w: 450, h: 500,
        content: `<div class="game-container"><h3>Memory Game</h3><p>Coming soon...</p></div>`
    }
};
</script>
</body>
</html>